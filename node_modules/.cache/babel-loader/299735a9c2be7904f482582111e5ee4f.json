{"ast":null,"code":"'use strict';\n/**\n * Dependencies\n */\n\nvar _classCallCheck = require(\"/Users/husnainmehmood/Desktop/Work/React/PP-AdminWeb/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/husnainmehmood/Desktop/Work/React/PP-AdminWeb/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar EmailAddress = require('./email-address');\n\nvar Personalization = require('./personalization');\n\nvar toCamelCase = require('../helpers/to-camel-case');\n\nvar toSnakeCase = require('../helpers/to-snake-case');\n\nvar deepClone = require('../helpers/deep-clone');\n\nvar arrayToJSON = require('../helpers/array-to-json');\n\nvar _require = require('../constants'),\n    DYNAMIC_TEMPLATE_CHAR_WARNING = _require.DYNAMIC_TEMPLATE_CHAR_WARNING;\n\nvar _require2 = require('../helpers/validate-settings'),\n    validateMailSettings = _require2.validateMailSettings,\n    validateTrackingSettings = _require2.validateTrackingSettings;\n/**\n * Mail class\n */\n\n\nvar Mail = /*#__PURE__*/function () {\n  /**\n   * Constructor\n   */\n  function Mail(data) {\n    _classCallCheck(this, Mail);\n\n    //Initialize array and object properties\n    this.isDynamic = false;\n    this.hideWarnings = false;\n    this.personalizations = [];\n    this.attachments = [];\n    this.content = [];\n    this.categories = [];\n    this.headers = {};\n    this.sections = {};\n    this.customArgs = {};\n    this.trackingSettings = {};\n    this.mailSettings = {};\n    this.asm = {}; //Helper properties\n\n    this.substitutions = null;\n    this.substitutionWrappers = null;\n    this.dynamicTemplateData = null; //Process data if given\n\n    if (data) {\n      this.fromData(data);\n    }\n  }\n  /**\n   * Build from data\n   */\n\n\n  _createClass(Mail, [{\n    key: \"fromData\",\n    value: function fromData(data) {\n      var _this = this;\n\n      //Expecting object\n      if (typeof data !== 'object') {\n        throw new Error('Expecting object for Mail data');\n      } //Convert to camel case to make it workable, making a copy to prevent\n      //changes to the original objects\n\n\n      data = deepClone(data);\n      data = toCamelCase(data, ['substitutions', 'dynamicTemplateData', 'customArgs', 'headers', 'sections']); //Extract properties from data\n\n      var _data = data,\n          to = _data.to,\n          from = _data.from,\n          replyTo = _data.replyTo,\n          cc = _data.cc,\n          bcc = _data.bcc,\n          sendAt = _data.sendAt,\n          subject = _data.subject,\n          text = _data.text,\n          html = _data.html,\n          content = _data.content,\n          templateId = _data.templateId,\n          personalizations = _data.personalizations,\n          attachments = _data.attachments,\n          ipPoolName = _data.ipPoolName,\n          batchId = _data.batchId,\n          sections = _data.sections,\n          headers = _data.headers,\n          categories = _data.categories,\n          category = _data.category,\n          customArgs = _data.customArgs,\n          asm = _data.asm,\n          mailSettings = _data.mailSettings,\n          trackingSettings = _data.trackingSettings,\n          substitutions = _data.substitutions,\n          substitutionWrappers = _data.substitutionWrappers,\n          dynamicTemplateData = _data.dynamicTemplateData,\n          isMultiple = _data.isMultiple,\n          hideWarnings = _data.hideWarnings,\n          replyToList = _data.replyToList; //Set data\n\n      this.setFrom(from);\n      this.setReplyTo(replyTo);\n      this.setSubject(subject);\n      this.setSendAt(sendAt);\n      this.setTemplateId(templateId);\n      this.setBatchId(batchId);\n      this.setIpPoolName(ipPoolName);\n      this.setAttachments(attachments);\n      this.setContent(content);\n      this.setSections(sections);\n      this.setHeaders(headers);\n      this.setCategories(category);\n      this.setCategories(categories);\n      this.setCustomArgs(customArgs);\n      this.setAsm(asm);\n      this.setMailSettings(mailSettings);\n      this.setTrackingSettings(trackingSettings);\n      this.setHideWarnings(hideWarnings);\n      this.setReplyToList(replyToList);\n\n      if (this.isDynamic) {\n        this.setDynamicTemplateData(dynamicTemplateData);\n      } else {\n        this.setSubstitutions(substitutions);\n        this.setSubstitutionWrappers(substitutionWrappers);\n      } //Add contents from text/html properties\n\n\n      this.addTextContent(text);\n      this.addHtmlContent(html); //Using \"to\" property for personalizations\n\n      if (personalizations) {\n        this.setPersonalizations(personalizations);\n      } else if (isMultiple && Array.isArray(to)) {\n        //Multiple individual emails\n        to.forEach(function (to) {\n          return _this.addTo(to, cc, bcc);\n        });\n      } else {\n        //Single email (possibly with multiple recipients in the to field)\n        this.addTo(to, cc, bcc);\n      }\n    }\n    /**\n     * Set from email\n     */\n\n  }, {\n    key: \"setFrom\",\n    value: function setFrom(from) {\n      if (this._checkProperty('from', from, [this._checkUndefined])) {\n        if (typeof from !== 'string' && typeof from.email !== 'string') {\n          throw new Error('String or address object expected for `from`');\n        }\n\n        this.from = EmailAddress.create(from);\n      }\n    }\n    /**\n     * Set reply to\n     */\n\n  }, {\n    key: \"setReplyTo\",\n    value: function setReplyTo(replyTo) {\n      if (this._checkProperty('replyTo', replyTo, [this._checkUndefined])) {\n        if (typeof replyTo !== 'string' && typeof replyTo.email !== 'string') {\n          throw new Error('String or address object expected for `replyTo`');\n        }\n\n        this.replyTo = EmailAddress.create(replyTo);\n      }\n    }\n    /**\n     * Set subject\n     */\n\n  }, {\n    key: \"setSubject\",\n    value: function setSubject(subject) {\n      this._setProperty('subject', subject, 'string');\n    }\n    /**\n     * Set send at\n     */\n\n  }, {\n    key: \"setSendAt\",\n    value: function setSendAt(sendAt) {\n      if (this._checkProperty('sendAt', sendAt, [this._checkUndefined, this._createCheckThatThrows(Number.isInteger, 'Integer expected for `sendAt`')])) {\n        this.sendAt = sendAt;\n      }\n    }\n    /**\n     * Set template ID, also checks if the template is dynamic or legacy\n     */\n\n  }, {\n    key: \"setTemplateId\",\n    value: function setTemplateId(templateId) {\n      if (this._setProperty('templateId', templateId, 'string')) {\n        if (templateId.indexOf('d-') === 0) {\n          this.isDynamic = true;\n        }\n      }\n    }\n    /**\n     * Set batch ID\n     */\n\n  }, {\n    key: \"setBatchId\",\n    value: function setBatchId(batchId) {\n      this._setProperty('batchId', batchId, 'string');\n    }\n    /**\n     * Set IP pool name\n     */\n\n  }, {\n    key: \"setIpPoolName\",\n    value: function setIpPoolName(ipPoolName) {\n      this._setProperty('ipPoolName', ipPoolName, 'string');\n    }\n    /**\n     * Set ASM\n     */\n\n  }, {\n    key: \"setAsm\",\n    value: function setAsm(asm) {\n      if (this._checkProperty('asm', asm, [this._checkUndefined, this._createTypeCheck('object')])) {\n        if (typeof asm.groupId !== 'number') {\n          throw new Error('Expected `asm` to include an integer in its `groupId` field');\n        }\n\n        if (asm.groupsToDisplay && (!Array.isArray(asm.groupsToDisplay) || !asm.groupsToDisplay.every(function (group) {\n          return typeof group === 'number';\n        }))) {\n          throw new Error('Array of integers expected for `asm.groupsToDisplay`');\n        }\n\n        this.asm = asm;\n      }\n    }\n    /**\n     * Set personalizations\n     */\n\n  }, {\n    key: \"setPersonalizations\",\n    value: function setPersonalizations(personalizations) {\n      var _this2 = this;\n\n      if (!this._doArrayCheck('personalizations', personalizations)) {\n        return;\n      }\n\n      if (!personalizations.every(function (personalization) {\n        return typeof personalization === 'object';\n      })) {\n        throw new Error('Array of objects expected for `personalizations`');\n      } //Clear and use add helper to add one by one\n\n\n      this.personalizations = [];\n      personalizations.forEach(function (personalization) {\n        return _this2.addPersonalization(personalization);\n      });\n    }\n    /**\n     * Add personalization\n     */\n\n  }, {\n    key: \"addPersonalization\",\n    value: function addPersonalization(personalization) {\n      //We should either send substitutions or dynamicTemplateData\n      //depending on the templateId\n      if (this.isDynamic && personalization.substitutions) {\n        delete personalization.substitutions;\n      } else if (!this.isDynamic && personalization.dynamicTemplateData) {\n        delete personalization.dynamicTemplateData;\n      } //Convert to class if needed\n\n\n      if (!(personalization instanceof Personalization)) {\n        personalization = new Personalization(personalization);\n      } //If this is dynamic, set dynamicTemplateData, or set substitutions\n\n\n      if (this.isDynamic) {\n        this.applyDynamicTemplateData(personalization);\n      } else {\n        this.applySubstitutions(personalization);\n      } //Push personalization to array\n\n\n      this.personalizations.push(personalization);\n    }\n    /**\n     * Convenience method for quickly creating personalizations\n     */\n\n  }, {\n    key: \"addTo\",\n    value: function addTo(to, cc, bcc) {\n      if (typeof to === 'undefined' && typeof cc === 'undefined' && typeof bcc === 'undefined') {\n        throw new Error('Provide at least one of to, cc or bcc');\n      }\n\n      this.addPersonalization(new Personalization({\n        to: to,\n        cc: cc,\n        bcc: bcc\n      }));\n    }\n    /**\n     * Set substitutions\n     */\n\n  }, {\n    key: \"setSubstitutions\",\n    value: function setSubstitutions(substitutions) {\n      this._setProperty('substitutions', substitutions, 'object');\n    }\n    /**\n     * Set substitution wrappers\n     */\n\n  }, {\n    key: \"setSubstitutionWrappers\",\n    value: function setSubstitutionWrappers(substitutionWrappers) {\n      var lengthCheck = function lengthCheck(propertyName, value) {\n        if (!Array.isArray(value) || value.length !== 2) {\n          throw new Error('Array expected with two elements for `' + propertyName + '`');\n        }\n      };\n\n      if (this._checkProperty('substitutionWrappers', substitutionWrappers, [this._checkUndefined, lengthCheck])) {\n        this.substitutionWrappers = substitutionWrappers;\n      }\n    }\n    /**\n     * Helper which applies globally set substitutions to personalizations\n     */\n\n  }, {\n    key: \"applySubstitutions\",\n    value: function applySubstitutions(personalization) {\n      if (personalization instanceof Personalization) {\n        personalization.reverseMergeSubstitutions(this.substitutions);\n        personalization.setSubstitutionWrappers(this.substitutionWrappers);\n      }\n    }\n    /**\n     * Helper which applies globally set dynamic_template_data to personalizations\n     */\n\n  }, {\n    key: \"applyDynamicTemplateData\",\n    value: function applyDynamicTemplateData(personalization) {\n      if (personalization instanceof Personalization) {\n        personalization.deepMergeDynamicTemplateData(this.dynamicTemplateData);\n      }\n    }\n    /**\n     * Set dynamicTemplateData\n     */\n\n  }, {\n    key: \"setDynamicTemplateData\",\n    value: function setDynamicTemplateData(dynamicTemplateData) {\n      if (typeof dynamicTemplateData === 'undefined') {\n        return;\n      }\n\n      if (typeof dynamicTemplateData !== 'object') {\n        throw new Error('Object expected for `dynamicTemplateData`');\n      } // Check dynamic template for non-escaped characters and warn if found\n\n\n      if (!this.hideWarnings) {\n        Object.values(dynamicTemplateData).forEach(function (value) {\n          if (/['\"&]/.test(value)) {\n            console.warn(DYNAMIC_TEMPLATE_CHAR_WARNING);\n          }\n        });\n      }\n\n      this.dynamicTemplateData = dynamicTemplateData;\n    }\n    /**\n     * Set content\n     */\n\n  }, {\n    key: \"setContent\",\n    value: function setContent(content) {\n      if (this._doArrayCheck('content', content)) {\n        if (!content.every(function (contentField) {\n          return typeof contentField === 'object';\n        })) {\n          throw new Error('Expected each entry in `content` to be an object');\n        }\n\n        if (!content.every(function (contentField) {\n          return typeof contentField.type === 'string';\n        })) {\n          throw new Error('Expected each `content` entry to contain a `type` string');\n        }\n\n        if (!content.every(function (contentField) {\n          return typeof contentField.value === 'string';\n        })) {\n          throw new Error('Expected each `content` entry to contain a `value` string');\n        }\n\n        this.content = content;\n      }\n    }\n    /**\n     * Add content\n     */\n\n  }, {\n    key: \"addContent\",\n    value: function addContent(content) {\n      if (this._checkProperty('content', content, [this._createTypeCheck('object')])) {\n        this.content.push(content);\n      }\n    }\n    /**\n     * Add text content\n     */\n\n  }, {\n    key: \"addTextContent\",\n    value: function addTextContent(text) {\n      if (this._checkProperty('text', text, [this._checkUndefined, this._createTypeCheck('string')])) {\n        this.addContent({\n          value: text,\n          type: 'text/plain'\n        });\n      }\n    }\n    /**\n     * Add HTML content\n     */\n\n  }, {\n    key: \"addHtmlContent\",\n    value: function addHtmlContent(html) {\n      if (this._checkProperty('html', html, [this._checkUndefined, this._createTypeCheck('string')])) {\n        this.addContent({\n          value: html,\n          type: 'text/html'\n        });\n      }\n    }\n    /**\n     * Set attachments\n     */\n\n  }, {\n    key: \"setAttachments\",\n    value: function setAttachments(attachments) {\n      if (this._doArrayCheck('attachments', attachments)) {\n        if (!attachments.every(function (attachment) {\n          return typeof attachment.content === 'string';\n        })) {\n          throw new Error('Expected each attachment to contain a `content` string');\n        }\n\n        if (!attachments.every(function (attachment) {\n          return typeof attachment.filename === 'string';\n        })) {\n          throw new Error('Expected each attachment to contain a `filename` string');\n        }\n\n        if (!attachments.every(function (attachment) {\n          return !attachment.type || typeof attachment.type === 'string';\n        })) {\n          throw new Error('Expected the attachment\\'s `type` field to be a string');\n        }\n\n        if (!attachments.every(function (attachment) {\n          return !attachment.disposition || typeof attachment.disposition === 'string';\n        })) {\n          throw new Error('Expected the attachment\\'s `disposition` field to be a string');\n        }\n\n        this.attachments = attachments;\n      }\n    }\n    /**\n     * Add attachment\n     */\n\n  }, {\n    key: \"addAttachment\",\n    value: function addAttachment(attachment) {\n      if (this._checkProperty('attachment', attachment, [this._checkUndefined, this._createTypeCheck('object')])) {\n        this.attachments.push(attachment);\n      }\n    }\n    /**\n     * Set categories\n     */\n\n  }, {\n    key: \"setCategories\",\n    value: function setCategories(categories) {\n      var allElementsAreStrings = function allElementsAreStrings(propertyName, value) {\n        if (!Array.isArray(value) || !value.every(function (item) {\n          return typeof item === 'string';\n        })) {\n          throw new Error('Array of strings expected for `' + propertyName + '`');\n        }\n      };\n\n      if (typeof categories === 'string') {\n        categories = [categories];\n      }\n\n      if (this._checkProperty('categories', categories, [this._checkUndefined, allElementsAreStrings])) {\n        this.categories = categories;\n      }\n    }\n    /**\n     * Add category\n     */\n\n  }, {\n    key: \"addCategory\",\n    value: function addCategory(category) {\n      if (this._checkProperty('category', category, [this._createTypeCheck('string')])) {\n        this.categories.push(category);\n      }\n    }\n    /**\n     * Set headers\n     */\n\n  }, {\n    key: \"setHeaders\",\n    value: function setHeaders(headers) {\n      this._setProperty('headers', headers, 'object');\n    }\n    /**\n     * Add a header\n     */\n\n  }, {\n    key: \"addHeader\",\n    value: function addHeader(key, value) {\n      if (this._checkProperty('key', key, [this._createTypeCheck('string')]) && this._checkProperty('value', value, [this._createTypeCheck('string')])) {\n        this.headers[key] = value;\n      }\n    }\n    /**\n     * Set sections\n     */\n\n  }, {\n    key: \"setSections\",\n    value: function setSections(sections) {\n      this._setProperty('sections', sections, 'object');\n    }\n    /**\n     * Set custom args\n     */\n\n  }, {\n    key: \"setCustomArgs\",\n    value: function setCustomArgs(customArgs) {\n      this._setProperty('customArgs', customArgs, 'object');\n    }\n    /**\n     * Set tracking settings\n     */\n\n  }, {\n    key: \"setTrackingSettings\",\n    value: function setTrackingSettings(settings) {\n      if (typeof settings === 'undefined') {\n        return;\n      }\n\n      validateTrackingSettings(settings);\n      this.trackingSettings = settings;\n    }\n    /**\n     * Set mail settings\n     */\n\n  }, {\n    key: \"setMailSettings\",\n    value: function setMailSettings(settings) {\n      if (typeof settings === 'undefined') {\n        return;\n      }\n\n      validateMailSettings(settings);\n      this.mailSettings = settings;\n    }\n    /**\n     * Set hide warnings\n     */\n\n  }, {\n    key: \"setHideWarnings\",\n    value: function setHideWarnings(hide) {\n      if (typeof hide === 'undefined') {\n        return;\n      }\n\n      if (typeof hide !== 'boolean') {\n        throw new Error('Boolean expected for `hideWarnings`');\n      }\n\n      this.hideWarnings = hide;\n    }\n    /**\n     * To JSON\n     */\n\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      //Extract properties from self\n      var from = this.from,\n          replyTo = this.replyTo,\n          sendAt = this.sendAt,\n          subject = this.subject,\n          content = this.content,\n          templateId = this.templateId,\n          personalizations = this.personalizations,\n          attachments = this.attachments,\n          ipPoolName = this.ipPoolName,\n          batchId = this.batchId,\n          asm = this.asm,\n          sections = this.sections,\n          headers = this.headers,\n          categories = this.categories,\n          customArgs = this.customArgs,\n          mailSettings = this.mailSettings,\n          trackingSettings = this.trackingSettings,\n          replyToList = this.replyToList; //Initialize with mandatory values\n\n      var json = {\n        from: from,\n        subject: subject,\n        personalizations: arrayToJSON(personalizations)\n      }; //Array properties\n\n      if (Array.isArray(attachments) && attachments.length > 0) {\n        json.attachments = arrayToJSON(attachments);\n      }\n\n      if (Array.isArray(categories) && categories.length > 0) {\n        json.categories = categories.filter(function (cat) {\n          return cat !== '';\n        });\n      }\n\n      if (Array.isArray(content) && content.length > 0) {\n        json.content = arrayToJSON(content);\n      } //Object properties\n\n\n      if (Object.keys(headers).length > 0) {\n        json.headers = headers;\n      }\n\n      if (Object.keys(mailSettings).length > 0) {\n        json.mailSettings = mailSettings;\n      }\n\n      if (Object.keys(trackingSettings).length > 0) {\n        json.trackingSettings = trackingSettings;\n      }\n\n      if (Object.keys(customArgs).length > 0) {\n        json.customArgs = customArgs;\n      }\n\n      if (Object.keys(sections).length > 0) {\n        json.sections = sections;\n      }\n\n      if (Object.keys(asm).length > 0) {\n        json.asm = asm;\n      } //Simple properties\n\n\n      if (typeof replyTo !== 'undefined') {\n        json.replyTo = replyTo;\n      }\n\n      if (typeof sendAt !== 'undefined') {\n        json.sendAt = sendAt;\n      }\n\n      if (typeof batchId !== 'undefined') {\n        json.batchId = batchId;\n      }\n\n      if (typeof templateId !== 'undefined') {\n        json.templateId = templateId;\n      }\n\n      if (typeof ipPoolName !== 'undefined') {\n        json.ipPoolName = ipPoolName;\n      }\n\n      if (typeof replyToList !== 'undefined') {\n        json.replyToList = replyToList;\n      } //Return as snake cased object\n\n\n      return toSnakeCase(json, ['substitutions', 'dynamicTemplateData', 'customArgs', 'headers', 'sections']);\n    }\n    /**************************************************************************\n     * Static helpers\n     ***/\n\n    /**\n     * Create a Mail instance from given data\n     */\n\n  }, {\n    key: \"_checkProperty\",\n    value:\n    /**************************************************************************\n     * helpers for property-setting checks\n     ***/\n\n    /**\n     * Perform a set of checks on the new property value. Returns true if all\n     * checks complete successfully without throwing errors or returning true.\n     */\n    function _checkProperty(propertyName, value, checks) {\n      return !checks.some(function (e) {\n        return e(propertyName, value);\n      });\n    }\n    /**\n     * Set a property with normal undefined and type-checks\n     */\n\n  }, {\n    key: \"_setProperty\",\n    value: function _setProperty(propertyName, value, propertyType) {\n      var propertyChecksPassed = this._checkProperty(propertyName, value, [this._checkUndefined, this._createTypeCheck(propertyType)]);\n\n      if (propertyChecksPassed) {\n        this[propertyName] = value;\n      }\n\n      return propertyChecksPassed;\n    }\n    /**\n     * Fail if the value is undefined.\n     */\n\n  }, {\n    key: \"_checkUndefined\",\n    value: function _checkUndefined(propertyName, value) {\n      return typeof value === 'undefined';\n    }\n    /**\n     * Create and return a function that checks for a given type\n     */\n\n  }, {\n    key: \"_createTypeCheck\",\n    value: function _createTypeCheck(propertyType) {\n      return function (propertyName, value) {\n        if (typeof value !== propertyType) {\n          throw new Error(propertyType + ' expected for `' + propertyName + '`');\n        }\n      };\n    }\n    /**\n     * Create a check out of a callback. If the callback\n     * returns false, the check will throw an error.\n     */\n\n  }, {\n    key: \"_createCheckThatThrows\",\n    value: function _createCheckThatThrows(check, errorString) {\n      return function (propertyName, value) {\n        if (!check(value)) {\n          throw new Error(errorString);\n        }\n      };\n    }\n    /**\n     * Set an array property after checking that the new value is an\n     * array.\n     */\n\n  }, {\n    key: \"_setArrayProperty\",\n    value: function _setArrayProperty(propertyName, value) {\n      if (this._doArrayCheck(propertyName, value)) {\n        this[propertyName] = value;\n      }\n    }\n    /**\n     * Check that a value isn't undefined and is an array.\n     */\n\n  }, {\n    key: \"_doArrayCheck\",\n    value: function _doArrayCheck(propertyName, value) {\n      return this._checkProperty(propertyName, value, [this._checkUndefined, this._createCheckThatThrows(Array.isArray, 'Array expected for`' + propertyName + '`')]);\n    }\n    /**\n     * Set the replyToList from email body\n     */\n\n  }, {\n    key: \"setReplyToList\",\n    value: function setReplyToList(replyToList) {\n      if (this._doArrayCheck('replyToList', replyToList) && replyToList.length) {\n        if (!replyToList.every(function (replyTo) {\n          return replyTo && typeof replyTo.email === 'string';\n        })) {\n          throw new Error('Expected each replyTo to contain an `email` string');\n        }\n\n        this.replyToList = replyToList;\n      }\n    }\n  }], [{\n    key: \"create\",\n    value: function create(data) {\n      var _this3 = this;\n\n      //Array?\n      if (Array.isArray(data)) {\n        return data.filter(function (item) {\n          return !!item;\n        }).map(function (item) {\n          return _this3.create(item);\n        });\n      } //Already instance of Mail class?\n\n\n      if (data instanceof Mail) {\n        return data;\n      } //Create instance\n\n\n      return new Mail(data);\n    }\n  }]);\n\n  return Mail;\n}(); //Export class\n\n\nmodule.exports = Mail;","map":{"version":3,"sources":["/Users/husnainmehmood/Desktop/Work/React/PP-AdminWeb/node_modules/@sendgrid/helpers/classes/mail.js"],"names":["EmailAddress","require","Personalization","toCamelCase","toSnakeCase","deepClone","arrayToJSON","DYNAMIC_TEMPLATE_CHAR_WARNING","validateMailSettings","validateTrackingSettings","Mail","data","isDynamic","hideWarnings","personalizations","attachments","content","categories","headers","sections","customArgs","trackingSettings","mailSettings","asm","substitutions","substitutionWrappers","dynamicTemplateData","fromData","Error","to","from","replyTo","cc","bcc","sendAt","subject","text","html","templateId","ipPoolName","batchId","category","isMultiple","replyToList","setFrom","setReplyTo","setSubject","setSendAt","setTemplateId","setBatchId","setIpPoolName","setAttachments","setContent","setSections","setHeaders","setCategories","setCustomArgs","setAsm","setMailSettings","setTrackingSettings","setHideWarnings","setReplyToList","setDynamicTemplateData","setSubstitutions","setSubstitutionWrappers","addTextContent","addHtmlContent","setPersonalizations","Array","isArray","forEach","addTo","_checkProperty","_checkUndefined","email","create","_setProperty","_createCheckThatThrows","Number","isInteger","indexOf","_createTypeCheck","groupId","groupsToDisplay","every","group","_doArrayCheck","personalization","addPersonalization","applyDynamicTemplateData","applySubstitutions","push","lengthCheck","propertyName","value","length","reverseMergeSubstitutions","deepMergeDynamicTemplateData","Object","values","test","console","warn","contentField","type","addContent","attachment","filename","disposition","allElementsAreStrings","item","key","settings","hide","json","filter","cat","keys","checks","some","e","propertyType","propertyChecksPassed","check","errorString","map","module","exports"],"mappings":"AAAA;AAEA;AACA;AACA;;;;;;AACA,IAAMA,YAAY,GAAGC,OAAO,CAAC,iBAAD,CAA5B;;AACA,IAAMC,eAAe,GAAGD,OAAO,CAAC,mBAAD,CAA/B;;AACA,IAAME,WAAW,GAAGF,OAAO,CAAC,0BAAD,CAA3B;;AACA,IAAMG,WAAW,GAAGH,OAAO,CAAC,0BAAD,CAA3B;;AACA,IAAMI,SAAS,GAAGJ,OAAO,CAAC,uBAAD,CAAzB;;AACA,IAAMK,WAAW,GAAGL,OAAO,CAAC,0BAAD,CAA3B;;AACA,eAA0CA,OAAO,CAAC,cAAD,CAAjD;AAAA,IAAQM,6BAAR,YAAQA,6BAAR;;AACA,gBAAyDN,OAAO,CAAC,8BAAD,CAAhE;AAAA,IAAOO,oBAAP,aAAOA,oBAAP;AAAA,IAA6BC,wBAA7B,aAA6BA,wBAA7B;AAEA;AACA;AACA;;;IACMC,I;AAEJ;AACF;AACA;AACE,gBAAYC,IAAZ,EAAkB;AAAA;;AAEhB;AACA,SAAKC,SAAL,GAAiB,KAAjB;AACA,SAAKC,YAAL,GAAoB,KAApB;AACA,SAAKC,gBAAL,GAAwB,EAAxB;AACA,SAAKC,WAAL,GAAmB,EAAnB;AACA,SAAKC,OAAL,GAAe,EAAf;AACA,SAAKC,UAAL,GAAkB,EAAlB;AACA,SAAKC,OAAL,GAAe,EAAf;AACA,SAAKC,QAAL,GAAgB,EAAhB;AACA,SAAKC,UAAL,GAAkB,EAAlB;AACA,SAAKC,gBAAL,GAAwB,EAAxB;AACA,SAAKC,YAAL,GAAoB,EAApB;AACA,SAAKC,GAAL,GAAW,EAAX,CAdgB,CAgBhB;;AACA,SAAKC,aAAL,GAAqB,IAArB;AACA,SAAKC,oBAAL,GAA4B,IAA5B;AACA,SAAKC,mBAAL,GAA2B,IAA3B,CAnBgB,CAqBhB;;AACA,QAAIf,IAAJ,EAAU;AACR,WAAKgB,QAAL,CAAchB,IAAd;AACD;AACF;AAED;AACF;AACA;;;;;WACE,kBAASA,IAAT,EAAe;AAAA;;AAEb;AACA,UAAI,OAAOA,IAAP,KAAgB,QAApB,EAA8B;AAC5B,cAAM,IAAIiB,KAAJ,CAAU,gCAAV,CAAN;AACD,OALY,CAOb;AACA;;;AACAjB,MAAAA,IAAI,GAAGN,SAAS,CAACM,IAAD,CAAhB;AACAA,MAAAA,IAAI,GAAGR,WAAW,CAACQ,IAAD,EAAO,CAAC,eAAD,EAAkB,qBAAlB,EAAyC,YAAzC,EAAuD,SAAvD,EAAkE,UAAlE,CAAP,CAAlB,CAVa,CAYb;;AACA,kBAMIA,IANJ;AAAA,UACEkB,EADF,SACEA,EADF;AAAA,UACMC,IADN,SACMA,IADN;AAAA,UACYC,OADZ,SACYA,OADZ;AAAA,UACqBC,EADrB,SACqBA,EADrB;AAAA,UACyBC,GADzB,SACyBA,GADzB;AAAA,UAC8BC,MAD9B,SAC8BA,MAD9B;AAAA,UACsCC,OADtC,SACsCA,OADtC;AAAA,UAC+CC,IAD/C,SAC+CA,IAD/C;AAAA,UACqDC,IADrD,SACqDA,IADrD;AAAA,UAC2DrB,OAD3D,SAC2DA,OAD3D;AAAA,UAEEsB,UAFF,SAEEA,UAFF;AAAA,UAEcxB,gBAFd,SAEcA,gBAFd;AAAA,UAEgCC,WAFhC,SAEgCA,WAFhC;AAAA,UAE6CwB,UAF7C,SAE6CA,UAF7C;AAAA,UAEyDC,OAFzD,SAEyDA,OAFzD;AAAA,UAGErB,QAHF,SAGEA,QAHF;AAAA,UAGYD,OAHZ,SAGYA,OAHZ;AAAA,UAGqBD,UAHrB,SAGqBA,UAHrB;AAAA,UAGiCwB,QAHjC,SAGiCA,QAHjC;AAAA,UAG2CrB,UAH3C,SAG2CA,UAH3C;AAAA,UAGuDG,GAHvD,SAGuDA,GAHvD;AAAA,UAG4DD,YAH5D,SAG4DA,YAH5D;AAAA,UAIED,gBAJF,SAIEA,gBAJF;AAAA,UAIoBG,aAJpB,SAIoBA,aAJpB;AAAA,UAImCC,oBAJnC,SAImCA,oBAJnC;AAAA,UAIyDC,mBAJzD,SAIyDA,mBAJzD;AAAA,UAI8EgB,UAJ9E,SAI8EA,UAJ9E;AAAA,UAKE7B,YALF,SAKEA,YALF;AAAA,UAKgB8B,WALhB,SAKgBA,WALhB,CAba,CAqBb;;AACA,WAAKC,OAAL,CAAad,IAAb;AACA,WAAKe,UAAL,CAAgBd,OAAhB;AACA,WAAKe,UAAL,CAAgBX,OAAhB;AACA,WAAKY,SAAL,CAAeb,MAAf;AACA,WAAKc,aAAL,CAAmBV,UAAnB;AACA,WAAKW,UAAL,CAAgBT,OAAhB;AACA,WAAKU,aAAL,CAAmBX,UAAnB;AACA,WAAKY,cAAL,CAAoBpC,WAApB;AACA,WAAKqC,UAAL,CAAgBpC,OAAhB;AACA,WAAKqC,WAAL,CAAiBlC,QAAjB;AACA,WAAKmC,UAAL,CAAgBpC,OAAhB;AACA,WAAKqC,aAAL,CAAmBd,QAAnB;AACA,WAAKc,aAAL,CAAmBtC,UAAnB;AACA,WAAKuC,aAAL,CAAmBpC,UAAnB;AACA,WAAKqC,MAAL,CAAYlC,GAAZ;AACA,WAAKmC,eAAL,CAAqBpC,YAArB;AACA,WAAKqC,mBAAL,CAAyBtC,gBAAzB;AACA,WAAKuC,eAAL,CAAqB/C,YAArB;AACA,WAAKgD,cAAL,CAAoBlB,WAApB;;AAEA,UAAI,KAAK/B,SAAT,EAAoB;AAClB,aAAKkD,sBAAL,CAA4BpC,mBAA5B;AACD,OAFD,MAEO;AACL,aAAKqC,gBAAL,CAAsBvC,aAAtB;AACA,aAAKwC,uBAAL,CAA6BvC,oBAA7B;AACD,OA/CY,CAiDb;;;AACA,WAAKwC,cAAL,CAAoB7B,IAApB;AACA,WAAK8B,cAAL,CAAoB7B,IAApB,EAnDa,CAqDb;;AACA,UAAIvB,gBAAJ,EAAsB;AACpB,aAAKqD,mBAAL,CAAyBrD,gBAAzB;AACD,OAFD,MAEO,IAAI4B,UAAU,IAAI0B,KAAK,CAACC,OAAN,CAAcxC,EAAd,CAAlB,EAAqC;AAC1C;AACAA,QAAAA,EAAE,CAACyC,OAAH,CAAW,UAAAzC,EAAE;AAAA,iBAAI,KAAI,CAAC0C,KAAL,CAAW1C,EAAX,EAAeG,EAAf,EAAmBC,GAAnB,CAAJ;AAAA,SAAb;AACD,OAHM,MAGA;AACL;AACA,aAAKsC,KAAL,CAAW1C,EAAX,EAAeG,EAAf,EAAmBC,GAAnB;AACD;AACF;AAED;AACF;AACA;;;;WACE,iBAAQH,IAAR,EAAc;AACZ,UAAI,KAAK0C,cAAL,CAAoB,MAApB,EAA4B1C,IAA5B,EAAkC,CAAC,KAAK2C,eAAN,CAAlC,CAAJ,EAA+D;AAC7D,YAAI,OAAO3C,IAAP,KAAgB,QAAhB,IAA4B,OAAOA,IAAI,CAAC4C,KAAZ,KAAsB,QAAtD,EAAgE;AAC9D,gBAAM,IAAI9C,KAAJ,CAAU,8CAAV,CAAN;AACD;;AACD,aAAKE,IAAL,GAAY9B,YAAY,CAAC2E,MAAb,CAAoB7C,IAApB,CAAZ;AACD;AACF;AAED;AACF;AACA;;;;WACE,oBAAWC,OAAX,EAAoB;AAClB,UAAI,KAAKyC,cAAL,CAAoB,SAApB,EAA+BzC,OAA/B,EAAwC,CAAC,KAAK0C,eAAN,CAAxC,CAAJ,EAAqE;AACnE,YAAI,OAAO1C,OAAP,KAAmB,QAAnB,IAA+B,OAAOA,OAAO,CAAC2C,KAAf,KAAyB,QAA5D,EAAsE;AACpE,gBAAM,IAAI9C,KAAJ,CAAU,iDAAV,CAAN;AACD;;AACD,aAAKG,OAAL,GAAe/B,YAAY,CAAC2E,MAAb,CAAoB5C,OAApB,CAAf;AACD;AACF;AAED;AACF;AACA;;;;WACE,oBAAWI,OAAX,EAAoB;AAClB,WAAKyC,YAAL,CAAkB,SAAlB,EAA6BzC,OAA7B,EAAsC,QAAtC;AACD;AAED;AACF;AACA;;;;WACE,mBAAUD,MAAV,EAAkB;AAChB,UAAI,KAAKsC,cAAL,CAAoB,QAApB,EAA8BtC,MAA9B,EAAsC,CAAC,KAAKuC,eAAN,EAAuB,KAAKI,sBAAL,CAA4BC,MAAM,CAACC,SAAnC,EAA8C,+BAA9C,CAAvB,CAAtC,CAAJ,EAAmJ;AACjJ,aAAK7C,MAAL,GAAcA,MAAd;AACD;AACF;AAED;AACF;AACA;;;;WACE,uBAAcI,UAAd,EAA0B;AACxB,UAAI,KAAKsC,YAAL,CAAkB,YAAlB,EAAgCtC,UAAhC,EAA4C,QAA5C,CAAJ,EAA2D;AACzD,YAAIA,UAAU,CAAC0C,OAAX,CAAmB,IAAnB,MAA6B,CAAjC,EAAoC;AAClC,eAAKpE,SAAL,GAAiB,IAAjB;AACD;AACF;AACF;AAED;AACF;AACA;;;;WACE,oBAAW4B,OAAX,EAAoB;AAClB,WAAKoC,YAAL,CAAkB,SAAlB,EAA6BpC,OAA7B,EAAsC,QAAtC;AACD;AAED;AACF;AACA;;;;WACE,uBAAcD,UAAd,EAA0B;AACxB,WAAKqC,YAAL,CAAkB,YAAlB,EAAgCrC,UAAhC,EAA4C,QAA5C;AACD;AAED;AACF;AACA;;;;WACE,gBAAOhB,GAAP,EAAY;AACV,UAAI,KAAKiD,cAAL,CAAoB,KAApB,EAA2BjD,GAA3B,EAAgC,CAAC,KAAKkD,eAAN,EAAuB,KAAKQ,gBAAL,CAAsB,QAAtB,CAAvB,CAAhC,CAAJ,EAA8F;AAC5F,YAAI,OAAO1D,GAAG,CAAC2D,OAAX,KAAuB,QAA3B,EAAqC;AACnC,gBAAM,IAAItD,KAAJ,CAAU,6DAAV,CAAN;AACD;;AACD,YAAIL,GAAG,CAAC4D,eAAJ,KACD,CAACf,KAAK,CAACC,OAAN,CAAc9C,GAAG,CAAC4D,eAAlB,CAAD,IAAuC,CAAC5D,GAAG,CAAC4D,eAAJ,CAAoBC,KAApB,CAA0B,UAAAC,KAAK;AAAA,iBAAI,OAAOA,KAAP,KAAiB,QAArB;AAAA,SAA/B,CADvC,CAAJ,EAC2G;AACzG,gBAAM,IAAIzD,KAAJ,CAAU,sDAAV,CAAN;AACD;;AACD,aAAKL,GAAL,GAAWA,GAAX;AACD;AACF;AAED;AACF;AACA;;;;WACE,6BAAoBT,gBAApB,EAAsC;AAAA;;AACpC,UAAI,CAAC,KAAKwE,aAAL,CAAmB,kBAAnB,EAAuCxE,gBAAvC,CAAL,EAA+D;AAC7D;AACD;;AAED,UAAI,CAACA,gBAAgB,CAACsE,KAAjB,CAAuB,UAAAG,eAAe;AAAA,eAAI,OAAOA,eAAP,KAA2B,QAA/B;AAAA,OAAtC,CAAL,EAAqF;AACnF,cAAM,IAAI3D,KAAJ,CAAU,kDAAV,CAAN;AACD,OAPmC,CASpC;;;AACA,WAAKd,gBAAL,GAAwB,EAAxB;AACAA,MAAAA,gBAAgB,CACbwD,OADH,CACW,UAAAiB,eAAe;AAAA,eAAI,MAAI,CAACC,kBAAL,CAAwBD,eAAxB,CAAJ;AAAA,OAD1B;AAED;AAED;AACF;AACA;;;;WACE,4BAAmBA,eAAnB,EAAoC;AAClC;AACA;AACA,UAAI,KAAK3E,SAAL,IAAkB2E,eAAe,CAAC/D,aAAtC,EAAqD;AACnD,eAAO+D,eAAe,CAAC/D,aAAvB;AACD,OAFD,MAEO,IAAI,CAAC,KAAKZ,SAAN,IAAmB2E,eAAe,CAAC7D,mBAAvC,EAA4D;AACjE,eAAO6D,eAAe,CAAC7D,mBAAvB;AACD,OAPiC,CASlC;;;AACA,UAAI,EAAE6D,eAAe,YAAYrF,eAA7B,CAAJ,EAAmD;AACjDqF,QAAAA,eAAe,GAAG,IAAIrF,eAAJ,CAAoBqF,eAApB,CAAlB;AACD,OAZiC,CAclC;;;AACA,UAAI,KAAK3E,SAAT,EAAoB;AAClB,aAAK6E,wBAAL,CAA8BF,eAA9B;AACD,OAFD,MAEO;AACL,aAAKG,kBAAL,CAAwBH,eAAxB;AACD,OAnBiC,CAqBlC;;;AACA,WAAKzE,gBAAL,CAAsB6E,IAAtB,CAA2BJ,eAA3B;AACD;AAED;AACF;AACA;;;;WACE,eAAM1D,EAAN,EAAUG,EAAV,EAAcC,GAAd,EAAmB;AACjB,UACE,OAAOJ,EAAP,KAAc,WAAd,IACA,OAAOG,EAAP,KAAc,WADd,IAEA,OAAOC,GAAP,KAAe,WAHjB,EAIE;AACA,cAAM,IAAIL,KAAJ,CAAU,uCAAV,CAAN;AACD;;AACD,WAAK4D,kBAAL,CAAwB,IAAItF,eAAJ,CAAoB;AAAC2B,QAAAA,EAAE,EAAFA,EAAD;AAAKG,QAAAA,EAAE,EAAFA,EAAL;AAASC,QAAAA,GAAG,EAAHA;AAAT,OAApB,CAAxB;AACD;AAED;AACF;AACA;;;;WACE,0BAAiBT,aAAjB,EAAgC;AAC9B,WAAKoD,YAAL,CAAkB,eAAlB,EAAmCpD,aAAnC,EAAkD,QAAlD;AACD;AAED;AACF;AACA;;;;WACE,iCAAwBC,oBAAxB,EAA8C;AAC5C,UAAImE,WAAW,GAAG,SAAdA,WAAc,CAACC,YAAD,EAAeC,KAAf,EAAyB;AACzC,YAAI,CAAC1B,KAAK,CAACC,OAAN,CAAcyB,KAAd,CAAD,IAAyBA,KAAK,CAACC,MAAN,KAAiB,CAA9C,EAAiD;AAC/C,gBAAM,IAAInE,KAAJ,CAAU,2CAA2CiE,YAA3C,GAA0D,GAApE,CAAN;AACD;AACF,OAJD;;AAMA,UAAI,KAAKrB,cAAL,CAAoB,sBAApB,EAA4C/C,oBAA5C,EAAkE,CAAC,KAAKgD,eAAN,EAAuBmB,WAAvB,CAAlE,CAAJ,EAA4G;AAC1G,aAAKnE,oBAAL,GAA4BA,oBAA5B;AACD;AACF;AAED;AACF;AACA;;;;WACE,4BAAmB8D,eAAnB,EAAoC;AAClC,UAAIA,eAAe,YAAYrF,eAA/B,EAAgD;AAC9CqF,QAAAA,eAAe,CAACS,yBAAhB,CAA0C,KAAKxE,aAA/C;AACA+D,QAAAA,eAAe,CAACvB,uBAAhB,CAAwC,KAAKvC,oBAA7C;AACD;AACF;AAED;AACF;AACA;;;;WACE,kCAAyB8D,eAAzB,EAA0C;AACxC,UAAIA,eAAe,YAAYrF,eAA/B,EAAgD;AAC9CqF,QAAAA,eAAe,CAACU,4BAAhB,CAA6C,KAAKvE,mBAAlD;AACD;AACF;AAED;AACF;AACA;;;;WACE,gCAAuBA,mBAAvB,EAA4C;AAC1C,UAAI,OAAOA,mBAAP,KAA+B,WAAnC,EAAgD;AAC9C;AACD;;AACD,UAAI,OAAOA,mBAAP,KAA+B,QAAnC,EAA6C;AAC3C,cAAM,IAAIE,KAAJ,CAAU,2CAAV,CAAN;AACD,OANyC,CAQ1C;;;AACA,UAAI,CAAC,KAAKf,YAAV,EAAwB;AACtBqF,QAAAA,MAAM,CAACC,MAAP,CAAczE,mBAAd,EAAmC4C,OAAnC,CAA2C,UAAAwB,KAAK,EAAI;AAClD,cAAI,QAAQM,IAAR,CAAaN,KAAb,CAAJ,EAAyB;AACvBO,YAAAA,OAAO,CAACC,IAAR,CAAa/F,6BAAb;AACD;AACF,SAJD;AAKD;;AAED,WAAKmB,mBAAL,GAA2BA,mBAA3B;AACD;AAED;AACF;AACA;;;;WACE,oBAAWV,OAAX,EAAoB;AAClB,UAAI,KAAKsE,aAAL,CAAmB,SAAnB,EAA8BtE,OAA9B,CAAJ,EAA4C;AAC1C,YAAI,CAACA,OAAO,CAACoE,KAAR,CAAc,UAAAmB,YAAY;AAAA,iBAAI,OAAOA,YAAP,KAAwB,QAA5B;AAAA,SAA1B,CAAL,EAAsE;AACpE,gBAAM,IAAI3E,KAAJ,CAAU,kDAAV,CAAN;AACD;;AACD,YAAI,CAACZ,OAAO,CAACoE,KAAR,CAAc,UAAAmB,YAAY;AAAA,iBAAI,OAAOA,YAAY,CAACC,IAApB,KAA6B,QAAjC;AAAA,SAA1B,CAAL,EAA2E;AACzE,gBAAM,IAAI5E,KAAJ,CAAU,0DAAV,CAAN;AACD;;AACD,YAAI,CAACZ,OAAO,CAACoE,KAAR,CAAc,UAAAmB,YAAY;AAAA,iBAAI,OAAOA,YAAY,CAACT,KAApB,KAA8B,QAAlC;AAAA,SAA1B,CAAL,EAA4E;AAC1E,gBAAM,IAAIlE,KAAJ,CAAU,2DAAV,CAAN;AACD;;AACD,aAAKZ,OAAL,GAAeA,OAAf;AACD;AACF;AAED;AACF;AACA;;;;WACE,oBAAWA,OAAX,EAAoB;AAClB,UAAI,KAAKwD,cAAL,CAAoB,SAApB,EAA+BxD,OAA/B,EAAwC,CAAC,KAAKiE,gBAAL,CAAsB,QAAtB,CAAD,CAAxC,CAAJ,EAAgF;AAC9E,aAAKjE,OAAL,CAAa2E,IAAb,CAAkB3E,OAAlB;AACD;AACF;AAED;AACF;AACA;;;;WACE,wBAAeoB,IAAf,EAAqB;AACnB,UAAI,KAAKoC,cAAL,CAAoB,MAApB,EAA4BpC,IAA5B,EAAkC,CAAC,KAAKqC,eAAN,EAAuB,KAAKQ,gBAAL,CAAsB,QAAtB,CAAvB,CAAlC,CAAJ,EAAgG;AAC9F,aAAKwB,UAAL,CAAgB;AACdX,UAAAA,KAAK,EAAE1D,IADO;AAEdoE,UAAAA,IAAI,EAAE;AAFQ,SAAhB;AAID;AACF;AAED;AACF;AACA;;;;WACE,wBAAenE,IAAf,EAAqB;AACnB,UAAI,KAAKmC,cAAL,CAAoB,MAApB,EAA4BnC,IAA5B,EAAkC,CAAC,KAAKoC,eAAN,EAAuB,KAAKQ,gBAAL,CAAsB,QAAtB,CAAvB,CAAlC,CAAJ,EAAgG;AAC9F,aAAKwB,UAAL,CAAgB;AACdX,UAAAA,KAAK,EAAEzD,IADO;AAEdmE,UAAAA,IAAI,EAAE;AAFQ,SAAhB;AAID;AACF;AAED;AACF;AACA;;;;WACE,wBAAezF,WAAf,EAA4B;AAC1B,UAAI,KAAKuE,aAAL,CAAmB,aAAnB,EAAkCvE,WAAlC,CAAJ,EAAoD;AAClD,YAAI,CAACA,WAAW,CAACqE,KAAZ,CAAkB,UAAAsB,UAAU;AAAA,iBAAI,OAAOA,UAAU,CAAC1F,OAAlB,KAA8B,QAAlC;AAAA,SAA5B,CAAL,EAA8E;AAC5E,gBAAM,IAAIY,KAAJ,CAAU,wDAAV,CAAN;AACD;;AACD,YAAI,CAACb,WAAW,CAACqE,KAAZ,CAAkB,UAAAsB,UAAU;AAAA,iBAAI,OAAOA,UAAU,CAACC,QAAlB,KAA+B,QAAnC;AAAA,SAA5B,CAAL,EAA+E;AAC7E,gBAAM,IAAI/E,KAAJ,CAAU,yDAAV,CAAN;AACD;;AACD,YAAI,CAACb,WAAW,CAACqE,KAAZ,CAAkB,UAAAsB,UAAU;AAAA,iBAAI,CAACA,UAAU,CAACF,IAAZ,IAAoB,OAAOE,UAAU,CAACF,IAAlB,KAA2B,QAAnD;AAAA,SAA5B,CAAL,EAA+F;AAC7F,gBAAM,IAAI5E,KAAJ,CAAU,wDAAV,CAAN;AACD;;AACD,YAAI,CAACb,WAAW,CAACqE,KAAZ,CAAkB,UAAAsB,UAAU;AAAA,iBAAI,CAACA,UAAU,CAACE,WAAZ,IAA2B,OAAOF,UAAU,CAACE,WAAlB,KAAkC,QAAjE;AAAA,SAA5B,CAAL,EAA6G;AAC3G,gBAAM,IAAIhF,KAAJ,CAAU,+DAAV,CAAN;AACD;;AACD,aAAKb,WAAL,GAAmBA,WAAnB;AACD;AACF;AAED;AACF;AACA;;;;WACE,uBAAc2F,UAAd,EAA0B;AACxB,UAAI,KAAKlC,cAAL,CAAoB,YAApB,EAAkCkC,UAAlC,EAA8C,CAAC,KAAKjC,eAAN,EAAuB,KAAKQ,gBAAL,CAAsB,QAAtB,CAAvB,CAA9C,CAAJ,EAA4G;AAC1G,aAAKlE,WAAL,CAAiB4E,IAAjB,CAAsBe,UAAtB;AACD;AACF;AAED;AACF;AACA;;;;WACE,uBAAczF,UAAd,EAA0B;AACxB,UAAI4F,qBAAqB,GAAG,SAAxBA,qBAAwB,CAAChB,YAAD,EAAeC,KAAf,EAAyB;AACnD,YAAI,CAAC1B,KAAK,CAACC,OAAN,CAAcyB,KAAd,CAAD,IAAyB,CAACA,KAAK,CAACV,KAAN,CAAY,UAAA0B,IAAI;AAAA,iBAAI,OAAOA,IAAP,KAAgB,QAApB;AAAA,SAAhB,CAA9B,EAA6E;AAC3E,gBAAM,IAAIlF,KAAJ,CAAU,oCAAoCiE,YAApC,GAAmD,GAA7D,CAAN;AACD;AACF,OAJD;;AAMA,UAAI,OAAO5E,UAAP,KAAsB,QAA1B,EAAoC;AAClCA,QAAAA,UAAU,GAAG,CAACA,UAAD,CAAb;AACD;;AAED,UAAI,KAAKuD,cAAL,CAAoB,YAApB,EAAkCvD,UAAlC,EAA8C,CAAC,KAAKwD,eAAN,EAAuBoC,qBAAvB,CAA9C,CAAJ,EAAkG;AAChG,aAAK5F,UAAL,GAAkBA,UAAlB;AACD;AACF;AAED;AACF;AACA;;;;WACE,qBAAYwB,QAAZ,EAAsB;AACpB,UAAI,KAAK+B,cAAL,CAAoB,UAApB,EAAgC/B,QAAhC,EAA0C,CAAC,KAAKwC,gBAAL,CAAsB,QAAtB,CAAD,CAA1C,CAAJ,EAAkF;AAChF,aAAKhE,UAAL,CAAgB0E,IAAhB,CAAqBlD,QAArB;AACD;AACF;AAED;AACF;AACA;;;;WACE,oBAAWvB,OAAX,EAAoB;AAClB,WAAK0D,YAAL,CAAkB,SAAlB,EAA6B1D,OAA7B,EAAsC,QAAtC;AACD;AAED;AACF;AACA;;;;WACE,mBAAU6F,GAAV,EAAejB,KAAf,EAAsB;AACpB,UAAI,KAAKtB,cAAL,CAAoB,KAApB,EAA2BuC,GAA3B,EAAgC,CAAC,KAAK9B,gBAAL,CAAsB,QAAtB,CAAD,CAAhC,KACC,KAAKT,cAAL,CAAoB,OAApB,EAA6BsB,KAA7B,EAAoC,CAAC,KAAKb,gBAAL,CAAsB,QAAtB,CAAD,CAApC,CADL,EAC6E;AAC3E,aAAK/D,OAAL,CAAa6F,GAAb,IAAoBjB,KAApB;AACD;AACF;AAED;AACF;AACA;;;;WACE,qBAAY3E,QAAZ,EAAsB;AACpB,WAAKyD,YAAL,CAAkB,UAAlB,EAA8BzD,QAA9B,EAAwC,QAAxC;AACD;AAED;AACF;AACA;;;;WACE,uBAAcC,UAAd,EAA0B;AACxB,WAAKwD,YAAL,CAAkB,YAAlB,EAAgCxD,UAAhC,EAA4C,QAA5C;AACD;AAED;AACF;AACA;;;;WACE,6BAAoB4F,QAApB,EAA8B;AAC5B,UAAI,OAAOA,QAAP,KAAoB,WAAxB,EAAqC;AACnC;AACD;;AACDvG,MAAAA,wBAAwB,CAACuG,QAAD,CAAxB;AACA,WAAK3F,gBAAL,GAAwB2F,QAAxB;AACD;AAED;AACF;AACA;;;;WACE,yBAAgBA,QAAhB,EAA0B;AACxB,UAAI,OAAOA,QAAP,KAAoB,WAAxB,EAAqC;AACnC;AACD;;AACDxG,MAAAA,oBAAoB,CAACwG,QAAD,CAApB;AACA,WAAK1F,YAAL,GAAoB0F,QAApB;AACD;AAED;AACF;AACA;;;;WACE,yBAAgBC,IAAhB,EAAsB;AACpB,UAAI,OAAOA,IAAP,KAAgB,WAApB,EAAiC;AAC/B;AACD;;AACD,UAAI,OAAOA,IAAP,KAAgB,SAApB,EAA+B;AAC7B,cAAM,IAAIrF,KAAJ,CAAU,qCAAV,CAAN;AACD;;AACD,WAAKf,YAAL,GAAoBoG,IAApB;AACD;AAED;AACF;AACA;;;;WACE,kBAAS;AAEP;AACA,UACEnF,IADF,GAKI,IALJ,CACEA,IADF;AAAA,UACQC,OADR,GAKI,IALJ,CACQA,OADR;AAAA,UACiBG,MADjB,GAKI,IALJ,CACiBA,MADjB;AAAA,UACyBC,OADzB,GAKI,IALJ,CACyBA,OADzB;AAAA,UACkCnB,OADlC,GAKI,IALJ,CACkCA,OADlC;AAAA,UAC2CsB,UAD3C,GAKI,IALJ,CAC2CA,UAD3C;AAAA,UAEExB,gBAFF,GAKI,IALJ,CAEEA,gBAFF;AAAA,UAEoBC,WAFpB,GAKI,IALJ,CAEoBA,WAFpB;AAAA,UAEiCwB,UAFjC,GAKI,IALJ,CAEiCA,UAFjC;AAAA,UAE6CC,OAF7C,GAKI,IALJ,CAE6CA,OAF7C;AAAA,UAEsDjB,GAFtD,GAKI,IALJ,CAEsDA,GAFtD;AAAA,UAGEJ,QAHF,GAKI,IALJ,CAGEA,QAHF;AAAA,UAGYD,OAHZ,GAKI,IALJ,CAGYA,OAHZ;AAAA,UAGqBD,UAHrB,GAKI,IALJ,CAGqBA,UAHrB;AAAA,UAGiCG,UAHjC,GAKI,IALJ,CAGiCA,UAHjC;AAAA,UAG6CE,YAH7C,GAKI,IALJ,CAG6CA,YAH7C;AAAA,UAIED,gBAJF,GAKI,IALJ,CAIEA,gBAJF;AAAA,UAIoBsB,WAJpB,GAKI,IALJ,CAIoBA,WAJpB,CAHO,CAUP;;AACA,UAAMuE,IAAI,GAAG;AACXpF,QAAAA,IAAI,EAAJA,IADW;AACLK,QAAAA,OAAO,EAAPA,OADK;AAEXrB,QAAAA,gBAAgB,EAAER,WAAW,CAACQ,gBAAD;AAFlB,OAAb,CAXO,CAgBP;;AACA,UAAIsD,KAAK,CAACC,OAAN,CAActD,WAAd,KAA8BA,WAAW,CAACgF,MAAZ,GAAqB,CAAvD,EAA0D;AACxDmB,QAAAA,IAAI,CAACnG,WAAL,GAAmBT,WAAW,CAACS,WAAD,CAA9B;AACD;;AACD,UAAIqD,KAAK,CAACC,OAAN,CAAcpD,UAAd,KAA6BA,UAAU,CAAC8E,MAAX,GAAoB,CAArD,EAAwD;AACtDmB,QAAAA,IAAI,CAACjG,UAAL,GAAkBA,UAAU,CAACkG,MAAX,CAAkB,UAAAC,GAAG;AAAA,iBAAIA,GAAG,KAAK,EAAZ;AAAA,SAArB,CAAlB;AACD;;AACD,UAAIhD,KAAK,CAACC,OAAN,CAAcrD,OAAd,KAA0BA,OAAO,CAAC+E,MAAR,GAAiB,CAA/C,EAAkD;AAChDmB,QAAAA,IAAI,CAAClG,OAAL,GAAeV,WAAW,CAACU,OAAD,CAA1B;AACD,OAzBM,CA2BP;;;AACA,UAAIkF,MAAM,CAACmB,IAAP,CAAYnG,OAAZ,EAAqB6E,MAArB,GAA8B,CAAlC,EAAqC;AACnCmB,QAAAA,IAAI,CAAChG,OAAL,GAAeA,OAAf;AACD;;AACD,UAAIgF,MAAM,CAACmB,IAAP,CAAY/F,YAAZ,EAA0ByE,MAA1B,GAAmC,CAAvC,EAA0C;AACxCmB,QAAAA,IAAI,CAAC5F,YAAL,GAAoBA,YAApB;AACD;;AACD,UAAI4E,MAAM,CAACmB,IAAP,CAAYhG,gBAAZ,EAA8B0E,MAA9B,GAAuC,CAA3C,EAA8C;AAC5CmB,QAAAA,IAAI,CAAC7F,gBAAL,GAAwBA,gBAAxB;AACD;;AACD,UAAI6E,MAAM,CAACmB,IAAP,CAAYjG,UAAZ,EAAwB2E,MAAxB,GAAiC,CAArC,EAAwC;AACtCmB,QAAAA,IAAI,CAAC9F,UAAL,GAAkBA,UAAlB;AACD;;AACD,UAAI8E,MAAM,CAACmB,IAAP,CAAYlG,QAAZ,EAAsB4E,MAAtB,GAA+B,CAAnC,EAAsC;AACpCmB,QAAAA,IAAI,CAAC/F,QAAL,GAAgBA,QAAhB;AACD;;AACD,UAAI+E,MAAM,CAACmB,IAAP,CAAY9F,GAAZ,EAAiBwE,MAAjB,GAA0B,CAA9B,EAAiC;AAC/BmB,QAAAA,IAAI,CAAC3F,GAAL,GAAWA,GAAX;AACD,OA7CM,CA+CP;;;AACA,UAAI,OAAOQ,OAAP,KAAmB,WAAvB,EAAoC;AAClCmF,QAAAA,IAAI,CAACnF,OAAL,GAAeA,OAAf;AACD;;AACD,UAAI,OAAOG,MAAP,KAAkB,WAAtB,EAAmC;AACjCgF,QAAAA,IAAI,CAAChF,MAAL,GAAcA,MAAd;AACD;;AACD,UAAI,OAAOM,OAAP,KAAmB,WAAvB,EAAoC;AAClC0E,QAAAA,IAAI,CAAC1E,OAAL,GAAeA,OAAf;AACD;;AACD,UAAI,OAAOF,UAAP,KAAsB,WAA1B,EAAuC;AACrC4E,QAAAA,IAAI,CAAC5E,UAAL,GAAkBA,UAAlB;AACD;;AACD,UAAI,OAAOC,UAAP,KAAsB,WAA1B,EAAuC;AACrC2E,QAAAA,IAAI,CAAC3E,UAAL,GAAkBA,UAAlB;AACD;;AACD,UAAG,OAAOI,WAAP,KAAuB,WAA1B,EAAuC;AACrCuE,QAAAA,IAAI,CAACvE,WAAL,GAAmBA,WAAnB;AACD,OAjEM,CAmEP;;;AACA,aAAOvC,WAAW,CAAC8G,IAAD,EAAO,CAAC,eAAD,EAAkB,qBAAlB,EAAyC,YAAzC,EAAuD,SAAvD,EAAkE,UAAlE,CAAP,CAAlB;AACD;AAED;AACF;AACA;;AAEE;AACF;AACA;;;;;AAmBE;AACF;AACA;;AAEE;AACF;AACA;AACA;AACE,4BAAerB,YAAf,EAA6BC,KAA7B,EAAoCwB,MAApC,EAA4C;AAC1C,aAAO,CAACA,MAAM,CAACC,IAAP,CAAY,UAACC,CAAD;AAAA,eAAOA,CAAC,CAAC3B,YAAD,EAAeC,KAAf,CAAR;AAAA,OAAZ,CAAR;AACD;AAED;AACF;AACA;;;;WACE,sBAAaD,YAAb,EAA2BC,KAA3B,EAAkC2B,YAAlC,EAAgD;AAC9C,UAAIC,oBAAoB,GAAG,KAAKlD,cAAL,CACzBqB,YADyB,EAEzBC,KAFyB,EAGzB,CAAC,KAAKrB,eAAN,EAAuB,KAAKQ,gBAAL,CAAsBwC,YAAtB,CAAvB,CAHyB,CAA3B;;AAKA,UAAIC,oBAAJ,EAA0B;AACxB,aAAK7B,YAAL,IAAqBC,KAArB;AACD;;AAED,aAAO4B,oBAAP;AACD;AAED;AACF;AACA;;;;WACE,yBAAgB7B,YAAhB,EAA8BC,KAA9B,EAAqC;AACnC,aAAO,OAAOA,KAAP,KAAiB,WAAxB;AACD;AAED;AACF;AACA;;;;WACE,0BAAiB2B,YAAjB,EAA+B;AAC7B,aAAO,UAAC5B,YAAD,EAAeC,KAAf,EAAyB;AAC9B,YAAI,OAAOA,KAAP,KAAiB2B,YAArB,EAAmC;AACjC,gBAAM,IAAI7F,KAAJ,CAAU6F,YAAY,GAAG,iBAAf,GAAmC5B,YAAnC,GAAkD,GAA5D,CAAN;AACD;AACF,OAJD;AAKD;AAED;AACF;AACA;AACA;;;;WACE,gCAAuB8B,KAAvB,EAA8BC,WAA9B,EAA2C;AACzC,aAAO,UAAC/B,YAAD,EAAeC,KAAf,EAAyB;AAC9B,YAAI,CAAC6B,KAAK,CAAC7B,KAAD,CAAV,EAAmB;AACjB,gBAAM,IAAIlE,KAAJ,CAAUgG,WAAV,CAAN;AACD;AACF,OAJD;AAKD;AAED;AACF;AACA;AACA;;;;WACE,2BAAkB/B,YAAlB,EAAgCC,KAAhC,EAAuC;AACrC,UAAI,KAAKR,aAAL,CAAmBO,YAAnB,EAAiCC,KAAjC,CAAJ,EAA6C;AAC3C,aAAKD,YAAL,IAAqBC,KAArB;AACD;AACF;AAED;AACF;AACA;;;;WACE,uBAAcD,YAAd,EAA4BC,KAA5B,EAAmC;AACjC,aAAO,KAAKtB,cAAL,CACLqB,YADK,EAELC,KAFK,EAGL,CAAC,KAAKrB,eAAN,EAAuB,KAAKI,sBAAL,CAA4BT,KAAK,CAACC,OAAlC,EAA2C,wBAAwBwB,YAAxB,GAAuC,GAAlF,CAAvB,CAHK,CAAP;AAID;AAED;AACF;AACA;;;;WACG,wBAAelD,WAAf,EAA4B;AAC3B,UAAI,KAAK2C,aAAL,CAAmB,aAAnB,EAAkC3C,WAAlC,KAAkDA,WAAW,CAACoD,MAAlE,EAA0E;AACxE,YAAI,CAACpD,WAAW,CAACyC,KAAZ,CAAkB,UAAArD,OAAO;AAAA,iBAAIA,OAAO,IAAI,OAAOA,OAAO,CAAC2C,KAAf,KAAyB,QAAxC;AAAA,SAAzB,CAAL,EAAiF;AAC/E,gBAAM,IAAI9C,KAAJ,CAAU,oDAAV,CAAN;AACD;;AACD,aAAKe,WAAL,GAAmBA,WAAnB;AACD;AACF;;;WA1GD,gBAAchC,IAAd,EAAoB;AAAA;;AAElB;AACA,UAAIyD,KAAK,CAACC,OAAN,CAAc1D,IAAd,CAAJ,EAAyB;AACvB,eAAOA,IAAI,CACRwG,MADI,CACG,UAAAL,IAAI;AAAA,iBAAI,CAAC,CAACA,IAAN;AAAA,SADP,EAEJe,GAFI,CAEA,UAAAf,IAAI;AAAA,iBAAI,MAAI,CAACnC,MAAL,CAAYmC,IAAZ,CAAJ;AAAA,SAFJ,CAAP;AAGD,OAPiB,CASlB;;;AACA,UAAInG,IAAI,YAAYD,IAApB,EAA0B;AACxB,eAAOC,IAAP;AACD,OAZiB,CAclB;;;AACA,aAAO,IAAID,IAAJ,CAASC,IAAT,CAAP;AACD;;;;KA6FH;;;AACAmH,MAAM,CAACC,OAAP,GAAiBrH,IAAjB","sourcesContent":["'use strict';\n\n/**\n * Dependencies\n */\nconst EmailAddress = require('./email-address');\nconst Personalization = require('./personalization');\nconst toCamelCase = require('../helpers/to-camel-case');\nconst toSnakeCase = require('../helpers/to-snake-case');\nconst deepClone = require('../helpers/deep-clone');\nconst arrayToJSON = require('../helpers/array-to-json');\nconst { DYNAMIC_TEMPLATE_CHAR_WARNING } = require('../constants');\nconst {validateMailSettings, validateTrackingSettings} = require('../helpers/validate-settings');\n\n/**\n * Mail class\n */\nclass Mail {\n\n  /**\n   * Constructor\n   */\n  constructor(data) {\n\n    //Initialize array and object properties\n    this.isDynamic = false;\n    this.hideWarnings = false;\n    this.personalizations = [];\n    this.attachments = [];\n    this.content = [];\n    this.categories = [];\n    this.headers = {};\n    this.sections = {};\n    this.customArgs = {};\n    this.trackingSettings = {};\n    this.mailSettings = {};\n    this.asm = {};\n\n    //Helper properties\n    this.substitutions = null;\n    this.substitutionWrappers = null;\n    this.dynamicTemplateData = null;\n\n    //Process data if given\n    if (data) {\n      this.fromData(data);\n    }\n  }\n\n  /**\n   * Build from data\n   */\n  fromData(data) {\n\n    //Expecting object\n    if (typeof data !== 'object') {\n      throw new Error('Expecting object for Mail data');\n    }\n\n    //Convert to camel case to make it workable, making a copy to prevent\n    //changes to the original objects\n    data = deepClone(data);\n    data = toCamelCase(data, ['substitutions', 'dynamicTemplateData', 'customArgs', 'headers', 'sections']);\n\n    //Extract properties from data\n    const {\n      to, from, replyTo, cc, bcc, sendAt, subject, text, html, content,\n      templateId, personalizations, attachments, ipPoolName, batchId,\n      sections, headers, categories, category, customArgs, asm, mailSettings,\n      trackingSettings, substitutions, substitutionWrappers, dynamicTemplateData, isMultiple,\n      hideWarnings, replyToList,\n    } = data;\n\n    //Set data\n    this.setFrom(from);\n    this.setReplyTo(replyTo);\n    this.setSubject(subject);\n    this.setSendAt(sendAt);\n    this.setTemplateId(templateId);\n    this.setBatchId(batchId);\n    this.setIpPoolName(ipPoolName);\n    this.setAttachments(attachments);\n    this.setContent(content);\n    this.setSections(sections);\n    this.setHeaders(headers);\n    this.setCategories(category);\n    this.setCategories(categories);\n    this.setCustomArgs(customArgs);\n    this.setAsm(asm);\n    this.setMailSettings(mailSettings);\n    this.setTrackingSettings(trackingSettings);\n    this.setHideWarnings(hideWarnings);\n    this.setReplyToList(replyToList);\n\n    if (this.isDynamic) {\n      this.setDynamicTemplateData(dynamicTemplateData);\n    } else {\n      this.setSubstitutions(substitutions);\n      this.setSubstitutionWrappers(substitutionWrappers);\n    }\n\n    //Add contents from text/html properties\n    this.addTextContent(text);\n    this.addHtmlContent(html);\n\n    //Using \"to\" property for personalizations\n    if (personalizations) {\n      this.setPersonalizations(personalizations);\n    } else if (isMultiple && Array.isArray(to)) {\n      //Multiple individual emails\n      to.forEach(to => this.addTo(to, cc, bcc));\n    } else {\n      //Single email (possibly with multiple recipients in the to field)\n      this.addTo(to, cc, bcc);\n    }\n  }\n\n  /**\n   * Set from email\n   */\n  setFrom(from) {\n    if (this._checkProperty('from', from, [this._checkUndefined])) {\n      if (typeof from !== 'string' && typeof from.email !== 'string') {\n        throw new Error('String or address object expected for `from`');\n      }\n      this.from = EmailAddress.create(from);\n    }\n  }\n\n  /**\n   * Set reply to\n   */\n  setReplyTo(replyTo) {\n    if (this._checkProperty('replyTo', replyTo, [this._checkUndefined])) {\n      if (typeof replyTo !== 'string' && typeof replyTo.email !== 'string') {\n        throw new Error('String or address object expected for `replyTo`');\n      }\n      this.replyTo = EmailAddress.create(replyTo);\n    }\n  }\n\n  /**\n   * Set subject\n   */\n  setSubject(subject) {\n    this._setProperty('subject', subject, 'string');\n  }\n\n  /**\n   * Set send at\n   */\n  setSendAt(sendAt) {\n    if (this._checkProperty('sendAt', sendAt, [this._checkUndefined, this._createCheckThatThrows(Number.isInteger, 'Integer expected for `sendAt`')])) {\n      this.sendAt = sendAt;\n    }\n  }\n\n  /**\n   * Set template ID, also checks if the template is dynamic or legacy\n   */\n  setTemplateId(templateId) {\n    if (this._setProperty('templateId', templateId, 'string')) {\n      if (templateId.indexOf('d-') === 0) {\n        this.isDynamic = true;\n      }\n    }\n  }\n\n  /**\n   * Set batch ID\n   */\n  setBatchId(batchId) {\n    this._setProperty('batchId', batchId, 'string');\n  }\n\n  /**\n   * Set IP pool name\n   */\n  setIpPoolName(ipPoolName) {\n    this._setProperty('ipPoolName', ipPoolName, 'string');\n  }\n\n  /**\n   * Set ASM\n   */\n  setAsm(asm) {\n    if (this._checkProperty('asm', asm, [this._checkUndefined, this._createTypeCheck('object')])) {\n      if (typeof asm.groupId !== 'number') {\n        throw new Error('Expected `asm` to include an integer in its `groupId` field');\n      }\n      if (asm.groupsToDisplay &&\n        (!Array.isArray(asm.groupsToDisplay) || !asm.groupsToDisplay.every(group => typeof group === 'number'))) {\n        throw new Error('Array of integers expected for `asm.groupsToDisplay`');\n      }\n      this.asm = asm;\n    }\n  }\n\n  /**\n   * Set personalizations\n   */\n  setPersonalizations(personalizations) {\n    if (!this._doArrayCheck('personalizations', personalizations)) {\n      return;\n    }\n\n    if (!personalizations.every(personalization => typeof personalization === 'object')) {\n      throw new Error('Array of objects expected for `personalizations`');\n    }\n\n    //Clear and use add helper to add one by one\n    this.personalizations = [];\n    personalizations\n      .forEach(personalization => this.addPersonalization(personalization));\n  }\n\n  /**\n   * Add personalization\n   */\n  addPersonalization(personalization) {\n    //We should either send substitutions or dynamicTemplateData\n    //depending on the templateId\n    if (this.isDynamic && personalization.substitutions) {\n      delete personalization.substitutions;\n    } else if (!this.isDynamic && personalization.dynamicTemplateData) {\n      delete personalization.dynamicTemplateData;\n    }\n\n    //Convert to class if needed\n    if (!(personalization instanceof Personalization)) {\n      personalization = new Personalization(personalization);\n    }\n\n    //If this is dynamic, set dynamicTemplateData, or set substitutions\n    if (this.isDynamic) {\n      this.applyDynamicTemplateData(personalization);\n    } else {\n      this.applySubstitutions(personalization);\n    }\n\n    //Push personalization to array\n    this.personalizations.push(personalization);\n  }\n\n  /**\n   * Convenience method for quickly creating personalizations\n   */\n  addTo(to, cc, bcc) {\n    if (\n      typeof to === 'undefined' &&\n      typeof cc === 'undefined' &&\n      typeof bcc === 'undefined'\n    ) {\n      throw new Error('Provide at least one of to, cc or bcc');\n    }\n    this.addPersonalization(new Personalization({to, cc, bcc}));\n  }\n\n  /**\n   * Set substitutions\n   */\n  setSubstitutions(substitutions) {\n    this._setProperty('substitutions', substitutions, 'object');\n  }\n\n  /**\n   * Set substitution wrappers\n   */\n  setSubstitutionWrappers(substitutionWrappers) {\n    let lengthCheck = (propertyName, value) => {\n      if (!Array.isArray(value) || value.length !== 2) {\n        throw new Error('Array expected with two elements for `' + propertyName + '`');\n      }\n    };\n\n    if (this._checkProperty('substitutionWrappers', substitutionWrappers, [this._checkUndefined, lengthCheck])) {\n      this.substitutionWrappers = substitutionWrappers;\n    }\n  }\n\n  /**\n   * Helper which applies globally set substitutions to personalizations\n   */\n  applySubstitutions(personalization) {\n    if (personalization instanceof Personalization) {\n      personalization.reverseMergeSubstitutions(this.substitutions);\n      personalization.setSubstitutionWrappers(this.substitutionWrappers);\n    }\n  }\n\n  /**\n   * Helper which applies globally set dynamic_template_data to personalizations\n   */\n  applyDynamicTemplateData(personalization) {\n    if (personalization instanceof Personalization) {\n      personalization.deepMergeDynamicTemplateData(this.dynamicTemplateData);\n    }\n  }\n\n  /**\n   * Set dynamicTemplateData\n   */\n  setDynamicTemplateData(dynamicTemplateData) {\n    if (typeof dynamicTemplateData === 'undefined') {\n      return;\n    }\n    if (typeof dynamicTemplateData !== 'object') {\n      throw new Error('Object expected for `dynamicTemplateData`');\n    }\n\n    // Check dynamic template for non-escaped characters and warn if found\n    if (!this.hideWarnings) {\n      Object.values(dynamicTemplateData).forEach(value => {\n        if (/['\"&]/.test(value)) {\n          console.warn(DYNAMIC_TEMPLATE_CHAR_WARNING);\n        }\n      });\n    }\n\n    this.dynamicTemplateData = dynamicTemplateData;\n  }\n\n  /**\n   * Set content\n   */\n  setContent(content) {\n    if (this._doArrayCheck('content', content)) {\n      if (!content.every(contentField => typeof contentField === 'object')) {\n        throw new Error('Expected each entry in `content` to be an object');\n      }\n      if (!content.every(contentField => typeof contentField.type === 'string')) {\n        throw new Error('Expected each `content` entry to contain a `type` string');\n      }\n      if (!content.every(contentField => typeof contentField.value === 'string')) {\n        throw new Error('Expected each `content` entry to contain a `value` string');\n      }\n      this.content = content;\n    }\n  }\n\n  /**\n   * Add content\n   */\n  addContent(content) {\n    if (this._checkProperty('content', content, [this._createTypeCheck('object')])) {\n      this.content.push(content);\n    }\n  }\n\n  /**\n   * Add text content\n   */\n  addTextContent(text) {\n    if (this._checkProperty('text', text, [this._checkUndefined, this._createTypeCheck('string')])) {\n      this.addContent({\n        value: text,\n        type: 'text/plain',\n      });\n    }\n  }\n\n  /**\n   * Add HTML content\n   */\n  addHtmlContent(html) {\n    if (this._checkProperty('html', html, [this._checkUndefined, this._createTypeCheck('string')])) {\n      this.addContent({\n        value: html,\n        type: 'text/html',\n      });\n    }\n  }\n\n  /**\n   * Set attachments\n   */\n  setAttachments(attachments) {\n    if (this._doArrayCheck('attachments', attachments)) {\n      if (!attachments.every(attachment => typeof attachment.content === 'string')) {\n        throw new Error('Expected each attachment to contain a `content` string');\n      }\n      if (!attachments.every(attachment => typeof attachment.filename === 'string')) {\n        throw new Error('Expected each attachment to contain a `filename` string');\n      }\n      if (!attachments.every(attachment => !attachment.type || typeof attachment.type === 'string')) {\n        throw new Error('Expected the attachment\\'s `type` field to be a string');\n      }\n      if (!attachments.every(attachment => !attachment.disposition || typeof attachment.disposition === 'string')) {\n        throw new Error('Expected the attachment\\'s `disposition` field to be a string');\n      }\n      this.attachments = attachments;\n    }\n  }\n\n  /**\n   * Add attachment\n   */\n  addAttachment(attachment) {\n    if (this._checkProperty('attachment', attachment, [this._checkUndefined, this._createTypeCheck('object')])) {\n      this.attachments.push(attachment);\n    }\n  }\n\n  /**\n   * Set categories\n   */\n  setCategories(categories) {\n    let allElementsAreStrings = (propertyName, value) => {\n      if (!Array.isArray(value) || !value.every(item => typeof item === 'string')) {\n        throw new Error('Array of strings expected for `' + propertyName + '`');\n      }\n    };\n\n    if (typeof categories === 'string') {\n      categories = [categories];\n    }\n\n    if (this._checkProperty('categories', categories, [this._checkUndefined, allElementsAreStrings])) {\n      this.categories = categories;\n    }\n  }\n\n  /**\n   * Add category\n   */\n  addCategory(category) {\n    if (this._checkProperty('category', category, [this._createTypeCheck('string')])) {\n      this.categories.push(category);\n    }\n  }\n\n  /**\n   * Set headers\n   */\n  setHeaders(headers) {\n    this._setProperty('headers', headers, 'object');\n  }\n\n  /**\n   * Add a header\n   */\n  addHeader(key, value) {\n    if (this._checkProperty('key', key, [this._createTypeCheck('string')])\n      && this._checkProperty('value', value, [this._createTypeCheck('string')])) {\n      this.headers[key] = value;\n    }\n  }\n\n  /**\n   * Set sections\n   */\n  setSections(sections) {\n    this._setProperty('sections', sections, 'object');\n  }\n\n  /**\n   * Set custom args\n   */\n  setCustomArgs(customArgs) {\n    this._setProperty('customArgs', customArgs, 'object');\n  }\n\n  /**\n   * Set tracking settings\n   */\n  setTrackingSettings(settings) {\n    if (typeof settings === 'undefined') {\n      return;\n    }\n    validateTrackingSettings(settings);\n    this.trackingSettings = settings;\n  }\n\n  /**\n   * Set mail settings\n   */\n  setMailSettings(settings) {\n    if (typeof settings === 'undefined') {\n      return;\n    }\n    validateMailSettings(settings);\n    this.mailSettings = settings;\n  }\n\n  /**\n   * Set hide warnings\n   */\n  setHideWarnings(hide) {\n    if (typeof hide === 'undefined') {\n      return;\n    }\n    if (typeof hide !== 'boolean') {\n      throw new Error('Boolean expected for `hideWarnings`');\n    }\n    this.hideWarnings = hide;\n  }\n\n  /**\n   * To JSON\n   */\n  toJSON() {\n\n    //Extract properties from self\n    const {\n      from, replyTo, sendAt, subject, content, templateId,\n      personalizations, attachments, ipPoolName, batchId, asm,\n      sections, headers, categories, customArgs, mailSettings,\n      trackingSettings, replyToList,\n    } = this;\n\n    //Initialize with mandatory values\n    const json = {\n      from, subject,\n      personalizations: arrayToJSON(personalizations),\n    };\n\n    //Array properties\n    if (Array.isArray(attachments) && attachments.length > 0) {\n      json.attachments = arrayToJSON(attachments);\n    }\n    if (Array.isArray(categories) && categories.length > 0) {\n      json.categories = categories.filter(cat => cat !== '');\n    }\n    if (Array.isArray(content) && content.length > 0) {\n      json.content = arrayToJSON(content);\n    }\n\n    //Object properties\n    if (Object.keys(headers).length > 0) {\n      json.headers = headers;\n    }\n    if (Object.keys(mailSettings).length > 0) {\n      json.mailSettings = mailSettings;\n    }\n    if (Object.keys(trackingSettings).length > 0) {\n      json.trackingSettings = trackingSettings;\n    }\n    if (Object.keys(customArgs).length > 0) {\n      json.customArgs = customArgs;\n    }\n    if (Object.keys(sections).length > 0) {\n      json.sections = sections;\n    }\n    if (Object.keys(asm).length > 0) {\n      json.asm = asm;\n    }\n\n    //Simple properties\n    if (typeof replyTo !== 'undefined') {\n      json.replyTo = replyTo;\n    }\n    if (typeof sendAt !== 'undefined') {\n      json.sendAt = sendAt;\n    }\n    if (typeof batchId !== 'undefined') {\n      json.batchId = batchId;\n    }\n    if (typeof templateId !== 'undefined') {\n      json.templateId = templateId;\n    }\n    if (typeof ipPoolName !== 'undefined') {\n      json.ipPoolName = ipPoolName;\n    }\n    if(typeof replyToList !== 'undefined') {\n      json.replyToList = replyToList;\n    }\n\n    //Return as snake cased object\n    return toSnakeCase(json, ['substitutions', 'dynamicTemplateData', 'customArgs', 'headers', 'sections']);\n  }\n\n  /**************************************************************************\n   * Static helpers\n   ***/\n\n  /**\n   * Create a Mail instance from given data\n   */\n  static create(data) {\n\n    //Array?\n    if (Array.isArray(data)) {\n      return data\n        .filter(item => !!item)\n        .map(item => this.create(item));\n    }\n\n    //Already instance of Mail class?\n    if (data instanceof Mail) {\n      return data;\n    }\n\n    //Create instance\n    return new Mail(data);\n  }\n\n  /**************************************************************************\n   * helpers for property-setting checks\n   ***/\n\n  /**\n   * Perform a set of checks on the new property value. Returns true if all\n   * checks complete successfully without throwing errors or returning true.\n   */\n  _checkProperty(propertyName, value, checks) {\n    return !checks.some((e) => e(propertyName, value));\n  }\n\n  /**\n   * Set a property with normal undefined and type-checks\n   */\n  _setProperty(propertyName, value, propertyType) {\n    let propertyChecksPassed = this._checkProperty(\n      propertyName,\n      value,\n      [this._checkUndefined, this._createTypeCheck(propertyType)]);\n\n    if (propertyChecksPassed) {\n      this[propertyName] = value;\n    }\n\n    return propertyChecksPassed;\n  }\n\n  /**\n   * Fail if the value is undefined.\n   */\n  _checkUndefined(propertyName, value) {\n    return typeof value === 'undefined';\n  }\n\n  /**\n   * Create and return a function that checks for a given type\n   */\n  _createTypeCheck(propertyType) {\n    return (propertyName, value) => {\n      if (typeof value !== propertyType) {\n        throw new Error(propertyType + ' expected for `' + propertyName + '`');\n      }\n    };\n  }\n\n  /**\n   * Create a check out of a callback. If the callback\n   * returns false, the check will throw an error.\n   */\n  _createCheckThatThrows(check, errorString) {\n    return (propertyName, value) => {\n      if (!check(value)) {\n        throw new Error(errorString);\n      }\n    };\n  }\n\n  /**\n   * Set an array property after checking that the new value is an\n   * array.\n   */\n  _setArrayProperty(propertyName, value) {\n    if (this._doArrayCheck(propertyName, value)) {\n      this[propertyName] = value;\n    }\n  }\n\n  /**\n   * Check that a value isn't undefined and is an array.\n   */\n  _doArrayCheck(propertyName, value) {\n    return this._checkProperty(\n      propertyName,\n      value,\n      [this._checkUndefined, this._createCheckThatThrows(Array.isArray, 'Array expected for`' + propertyName + '`')]);\n  }\n\n  /**\n   * Set the replyToList from email body\n   */\n   setReplyToList(replyToList) {\n    if (this._doArrayCheck('replyToList', replyToList) && replyToList.length) {\n      if (!replyToList.every(replyTo => replyTo && typeof replyTo.email === 'string')) {\n        throw new Error('Expected each replyTo to contain an `email` string');\n      }\n      this.replyToList = replyToList;\n    }\n  }\n}\n\n//Export class\nmodule.exports = Mail;\n"]},"metadata":{},"sourceType":"script"}