{"ast":null,"code":"'use strict';\n/**\n * Dependencies\n */\n\nvar _slicedToArray = require(\"/Users/husnainmehmood/Desktop/Work/React/PP-AdminWeb/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/slicedToArray\");\n\nvar _classCallCheck = require(\"/Users/husnainmehmood/Desktop/Work/React/PP-AdminWeb/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/husnainmehmood/Desktop/Work/React/PP-AdminWeb/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar EmailAddress = require('./email-address');\n\nvar toCamelCase = require('../helpers/to-camel-case');\n\nvar toSnakeCase = require('../helpers/to-snake-case');\n\nvar deepClone = require('../helpers/deep-clone');\n\nvar deepMerge = require('deepmerge');\n\nvar wrapSubstitutions = require('../helpers/wrap-substitutions');\n/**\n * Personalization class\n */\n\n\nvar Personalization = /*#__PURE__*/function () {\n  /**\n   * Constructor\n   */\n  function Personalization(data) {\n    _classCallCheck(this, Personalization);\n\n    //Init array and object placeholders\n    this.to = [];\n    this.cc = [];\n    this.bcc = [];\n    this.headers = {};\n    this.customArgs = {};\n    this.substitutions = {};\n    this.substitutionWrappers = ['{{', '}}'];\n    this.dynamicTemplateData = {}; //Build from data if given\n\n    if (data) {\n      this.fromData(data);\n    }\n  }\n  /**\n   * From data\n   */\n\n\n  _createClass(Personalization, [{\n    key: \"fromData\",\n    value: function fromData(data) {\n      //Expecting object\n      if (typeof data !== 'object') {\n        throw new Error('Expecting object for Mail data');\n      } //Convert to camel case to make it workable, making a copy to prevent\n      //changes to the original objects\n\n\n      data = deepClone(data);\n      data = toCamelCase(data, ['substitutions', 'dynamicTemplateData', 'customArgs', 'headers']); //Extract properties from data\n\n      var _data = data,\n          to = _data.to,\n          from = _data.from,\n          cc = _data.cc,\n          bcc = _data.bcc,\n          subject = _data.subject,\n          headers = _data.headers,\n          customArgs = _data.customArgs,\n          sendAt = _data.sendAt,\n          substitutions = _data.substitutions,\n          substitutionWrappers = _data.substitutionWrappers,\n          dynamicTemplateData = _data.dynamicTemplateData; //Set data\n\n      this.setTo(to);\n      this.setFrom(from);\n      this.setCc(cc);\n      this.setBcc(bcc);\n      this.setSubject(subject);\n      this.setHeaders(headers);\n      this.setSubstitutions(substitutions);\n      this.setSubstitutionWrappers(substitutionWrappers);\n      this.setCustomArgs(customArgs);\n      this.setDynamicTemplateData(dynamicTemplateData);\n      this.setSendAt(sendAt);\n    }\n    /**\n     * Set subject\n     */\n\n  }, {\n    key: \"setSubject\",\n    value: function setSubject(subject) {\n      if (typeof subject === 'undefined') {\n        return;\n      }\n\n      if (typeof subject !== 'string') {\n        throw new Error('String expected for `subject`');\n      }\n\n      this.subject = subject;\n    }\n    /**\n     * Set send at\n     */\n\n  }, {\n    key: \"setSendAt\",\n    value: function setSendAt(sendAt) {\n      if (typeof sendAt === 'undefined') {\n        return;\n      }\n\n      if (!Number.isInteger(sendAt)) {\n        throw new Error('Integer expected for `sendAt`');\n      }\n\n      this.sendAt = sendAt;\n    }\n    /**\n     * Set to\n     */\n\n  }, {\n    key: \"setTo\",\n    value: function setTo(to) {\n      if (typeof to === 'undefined') {\n        return;\n      }\n\n      if (!Array.isArray(to)) {\n        to = [to];\n      }\n\n      this.to = EmailAddress.create(to);\n    }\n    /**\n     * Set from\n     * */\n\n  }, {\n    key: \"setFrom\",\n    value: function setFrom(from) {\n      if (typeof from === 'undefined') {\n        return;\n      }\n\n      this.from = EmailAddress.create(from);\n    }\n    /**\n     * Add a single to\n     */\n\n  }, {\n    key: \"addTo\",\n    value: function addTo(to) {\n      if (typeof to === 'undefined') {\n        return;\n      }\n\n      this.to.push(EmailAddress.create(to));\n    }\n    /**\n     * Set cc\n     */\n\n  }, {\n    key: \"setCc\",\n    value: function setCc(cc) {\n      if (typeof cc === 'undefined') {\n        return;\n      }\n\n      if (!Array.isArray(cc)) {\n        cc = [cc];\n      }\n\n      this.cc = EmailAddress.create(cc);\n    }\n    /**\n     * Add a single cc\n     */\n\n  }, {\n    key: \"addCc\",\n    value: function addCc(cc) {\n      if (typeof cc === 'undefined') {\n        return;\n      }\n\n      this.cc.push(EmailAddress.create(cc));\n    }\n    /**\n     * Set bcc\n     */\n\n  }, {\n    key: \"setBcc\",\n    value: function setBcc(bcc) {\n      if (typeof bcc === 'undefined') {\n        return;\n      }\n\n      if (!Array.isArray(bcc)) {\n        bcc = [bcc];\n      }\n\n      this.bcc = EmailAddress.create(bcc);\n    }\n    /**\n     * Add a single bcc\n     */\n\n  }, {\n    key: \"addBcc\",\n    value: function addBcc(bcc) {\n      if (typeof bcc === 'undefined') {\n        return;\n      }\n\n      this.bcc.push(EmailAddress.create(bcc));\n    }\n    /**\n     * Set headers\n     */\n\n  }, {\n    key: \"setHeaders\",\n    value: function setHeaders(headers) {\n      if (typeof headers === 'undefined') {\n        return;\n      }\n\n      if (typeof headers !== 'object' || headers === null) {\n        throw new Error('Object expected for `headers`');\n      }\n\n      this.headers = headers;\n    }\n    /**\n     * Add a header\n     */\n\n  }, {\n    key: \"addHeader\",\n    value: function addHeader(key, value) {\n      if (typeof key !== 'string') {\n        throw new Error('String expected for header key');\n      }\n\n      if (typeof value !== 'string') {\n        throw new Error('String expected for header value');\n      }\n\n      this.headers[key] = value;\n    }\n    /**\n     * Set custom args\n     */\n\n  }, {\n    key: \"setCustomArgs\",\n    value: function setCustomArgs(customArgs) {\n      if (typeof customArgs === 'undefined') {\n        return;\n      }\n\n      if (typeof customArgs !== 'object' || customArgs === null) {\n        throw new Error('Object expected for `customArgs`');\n      }\n\n      this.customArgs = customArgs;\n    }\n    /**\n     * Add a custom arg\n     */\n\n  }, {\n    key: \"addCustomArg\",\n    value: function addCustomArg(key, value) {\n      if (typeof key !== 'string') {\n        throw new Error('String expected for custom arg key');\n      }\n\n      if (typeof value !== 'string') {\n        throw new Error('String expected for custom arg value');\n      }\n\n      this.customArgs[key] = value;\n    }\n    /**\n     * Set substitutions\n     */\n\n  }, {\n    key: \"setSubstitutions\",\n    value: function setSubstitutions(substitutions) {\n      if (typeof substitutions === 'undefined') {\n        return;\n      }\n\n      if (typeof substitutions !== 'object') {\n        throw new Error('Object expected for `substitutions`');\n      }\n\n      this.substitutions = substitutions;\n    }\n    /**\n     * Add a substitution\n     */\n\n  }, {\n    key: \"addSubstitution\",\n    value: function addSubstitution(key, value) {\n      if (typeof key !== 'string') {\n        throw new Error('String expected for substitution key');\n      }\n\n      if (typeof value !== 'string' && typeof value !== 'number') {\n        throw new Error('String or Number expected for substitution value');\n      }\n\n      this.substitutions[key] = value;\n    }\n    /**\n     * Reverse merge substitutions, preserving existing ones\n     */\n\n  }, {\n    key: \"reverseMergeSubstitutions\",\n    value: function reverseMergeSubstitutions(substitutions) {\n      if (typeof substitutions === 'undefined' || substitutions === null) {\n        return;\n      }\n\n      if (typeof substitutions !== 'object') {\n        throw new Error('Object expected for `substitutions` in reverseMergeSubstitutions');\n      }\n\n      this.substitutions = Object.assign({}, substitutions, this.substitutions);\n    }\n    /**\n     * Set substitution wrappers\n     */\n\n  }, {\n    key: \"setSubstitutionWrappers\",\n    value: function setSubstitutionWrappers(wrappers) {\n      if (typeof wrappers === 'undefined' || wrappers === null) {\n        return;\n      }\n\n      if (!Array.isArray(wrappers) || wrappers.length !== 2) {\n        throw new Error('Array expected with two elements for `substitutionWrappers`');\n      }\n\n      this.substitutionWrappers = wrappers;\n    }\n    /**\n     * Reverse merge dynamic template data, preserving existing ones\n     */\n\n  }, {\n    key: \"deepMergeDynamicTemplateData\",\n    value: function deepMergeDynamicTemplateData(dynamicTemplateData) {\n      if (typeof dynamicTemplateData === 'undefined' || dynamicTemplateData === null) {\n        return;\n      }\n\n      if (typeof dynamicTemplateData !== 'object') {\n        throw new Error('Object expected for `dynamicTemplateData` in deepMergeDynamicTemplateData');\n      }\n\n      this.dynamicTemplateData = deepMerge(dynamicTemplateData, this.dynamicTemplateData);\n    }\n    /**\n     * Set dynamic template data\n     */\n\n  }, {\n    key: \"setDynamicTemplateData\",\n    value: function setDynamicTemplateData(dynamicTemplateData) {\n      if (typeof dynamicTemplateData === 'undefined') {\n        return;\n      }\n\n      if (typeof dynamicTemplateData !== 'object') {\n        throw new Error('Object expected for `dynamicTemplateData`');\n      }\n\n      this.dynamicTemplateData = dynamicTemplateData;\n    }\n    /**\n     * To JSON\n     */\n\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      //Get data from self\n      var to = this.to,\n          from = this.from,\n          cc = this.cc,\n          bcc = this.bcc,\n          subject = this.subject,\n          headers = this.headers,\n          customArgs = this.customArgs,\n          sendAt = this.sendAt,\n          substitutions = this.substitutions,\n          substitutionWrappers = this.substitutionWrappers,\n          dynamicTemplateData = this.dynamicTemplateData; //Initialize with mandatory values\n\n      var json = {\n        to: to\n      }; //Arrays\n\n      if (Array.isArray(cc) && cc.length > 0) {\n        json.cc = cc;\n      }\n\n      if (Array.isArray(bcc) && bcc.length > 0) {\n        json.bcc = bcc;\n      } //Objects\n\n\n      if (Object.keys(headers).length > 0) {\n        json.headers = headers;\n      }\n\n      if (substitutions && Object.keys(substitutions).length > 0) {\n        var _substitutionWrappers = _slicedToArray(substitutionWrappers, 2),\n            left = _substitutionWrappers[0],\n            right = _substitutionWrappers[1];\n\n        json.substitutions = wrapSubstitutions(substitutions, left, right);\n      }\n\n      if (Object.keys(customArgs).length > 0) {\n        json.customArgs = customArgs;\n      }\n\n      if (dynamicTemplateData && Object.keys(dynamicTemplateData).length > 0) {\n        json.dynamicTemplateData = dynamicTemplateData;\n      } //Simple properties\n\n\n      if (typeof subject !== 'undefined') {\n        json.subject = subject;\n      }\n\n      if (typeof sendAt !== 'undefined') {\n        json.sendAt = sendAt;\n      }\n\n      if (typeof from !== 'undefined') {\n        json.from = from;\n      } //Return as snake cased object\n\n\n      return toSnakeCase(json, ['substitutions', 'dynamicTemplateData', 'customArgs', 'headers']);\n    }\n  }]);\n\n  return Personalization;\n}(); //Export class\n\n\nmodule.exports = Personalization;","map":{"version":3,"sources":["/Users/husnainmehmood/Desktop/Work/React/PP-AdminWeb/node_modules/@sendgrid/helpers/classes/personalization.js"],"names":["EmailAddress","require","toCamelCase","toSnakeCase","deepClone","deepMerge","wrapSubstitutions","Personalization","data","to","cc","bcc","headers","customArgs","substitutions","substitutionWrappers","dynamicTemplateData","fromData","Error","from","subject","sendAt","setTo","setFrom","setCc","setBcc","setSubject","setHeaders","setSubstitutions","setSubstitutionWrappers","setCustomArgs","setDynamicTemplateData","setSendAt","Number","isInteger","Array","isArray","create","push","key","value","Object","assign","wrappers","length","json","keys","left","right","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\n/**\n * Dependencies\n */\nconst EmailAddress = require('./email-address');\nconst toCamelCase = require('../helpers/to-camel-case');\nconst toSnakeCase = require('../helpers/to-snake-case');\nconst deepClone = require('../helpers/deep-clone');\nconst deepMerge = require('deepmerge');\nconst wrapSubstitutions = require('../helpers/wrap-substitutions');\n\n/**\n * Personalization class\n */\nclass Personalization {\n\n  /**\n   * Constructor\n   */\n  constructor(data) {\n\n    //Init array and object placeholders\n    this.to = [];\n    this.cc = [];\n    this.bcc = [];\n    this.headers = {};\n    this.customArgs = {};\n    this.substitutions = {};\n    this.substitutionWrappers = ['{{', '}}'];\n    this.dynamicTemplateData = {};\n\n    //Build from data if given\n    if (data) {\n      this.fromData(data);\n    }\n  }\n\n  /**\n   * From data\n   */\n  fromData(data) {\n\n    //Expecting object\n    if (typeof data !== 'object') {\n      throw new Error('Expecting object for Mail data');\n    }\n\n    //Convert to camel case to make it workable, making a copy to prevent\n    //changes to the original objects\n    data = deepClone(data);\n    data = toCamelCase(data, ['substitutions', 'dynamicTemplateData', 'customArgs', 'headers']);\n\n    //Extract properties from data\n    const {\n      to, from, cc, bcc, subject, headers, customArgs, sendAt,\n      substitutions, substitutionWrappers, dynamicTemplateData,\n    } = data;\n\n    //Set data\n    this.setTo(to);\n    this.setFrom(from);\n    this.setCc(cc);\n    this.setBcc(bcc);\n    this.setSubject(subject);\n    this.setHeaders(headers);\n    this.setSubstitutions(substitutions);\n    this.setSubstitutionWrappers(substitutionWrappers);\n    this.setCustomArgs(customArgs);\n    this.setDynamicTemplateData(dynamicTemplateData);\n    this.setSendAt(sendAt);\n  }\n\n  /**\n   * Set subject\n   */\n  setSubject(subject) {\n    if (typeof subject === 'undefined') {\n      return;\n    }\n    if (typeof subject !== 'string') {\n      throw new Error('String expected for `subject`');\n    }\n    this.subject = subject;\n  }\n\n  /**\n   * Set send at\n   */\n  setSendAt(sendAt) {\n    if (typeof sendAt === 'undefined') {\n      return;\n    }\n    if (!Number.isInteger(sendAt)) {\n      throw new Error('Integer expected for `sendAt`');\n    }\n    this.sendAt = sendAt;\n  }\n\n  /**\n   * Set to\n   */\n  setTo(to) {\n    if (typeof to === 'undefined') {\n      return;\n    }\n    if (!Array.isArray(to)) {\n      to = [to];\n    }\n    this.to = EmailAddress.create(to);\n  }\n\n  /**\n   * Set from\n   * */\n  setFrom(from) {\n    if (typeof from === 'undefined') {\n      return;\n    }\n    this.from = EmailAddress.create(from);\n  }\n\n  /**\n   * Add a single to\n   */\n  addTo(to) {\n    if (typeof to === 'undefined') {\n      return;\n    }\n    this.to.push(EmailAddress.create(to));\n  }\n\n  /**\n   * Set cc\n   */\n  setCc(cc) {\n    if (typeof cc === 'undefined') {\n      return;\n    }\n    if (!Array.isArray(cc)) {\n      cc = [cc];\n    }\n    this.cc = EmailAddress.create(cc);\n  }\n\n  /**\n   * Add a single cc\n   */\n  addCc(cc) {\n    if (typeof cc === 'undefined') {\n      return;\n    }\n    this.cc.push(EmailAddress.create(cc));\n  }\n\n  /**\n   * Set bcc\n   */\n  setBcc(bcc) {\n    if (typeof bcc === 'undefined') {\n      return;\n    }\n    if (!Array.isArray(bcc)) {\n      bcc = [bcc];\n    }\n    this.bcc = EmailAddress.create(bcc);\n  }\n\n  /**\n   * Add a single bcc\n   */\n  addBcc(bcc) {\n    if (typeof bcc === 'undefined') {\n      return;\n    }\n    this.bcc.push(EmailAddress.create(bcc));\n  }\n\n  /**\n   * Set headers\n   */\n  setHeaders(headers) {\n    if (typeof headers === 'undefined') {\n      return;\n    }\n    if (typeof headers !== 'object' || headers === null) {\n      throw new Error('Object expected for `headers`');\n    }\n    this.headers = headers;\n  }\n\n  /**\n   * Add a header\n   */\n  addHeader(key, value) {\n    if (typeof key !== 'string') {\n      throw new Error('String expected for header key');\n    }\n    if (typeof value !== 'string') {\n      throw new Error('String expected for header value');\n    }\n    this.headers[key] = value;\n  }\n\n  /**\n   * Set custom args\n   */\n  setCustomArgs(customArgs) {\n    if (typeof customArgs === 'undefined') {\n      return;\n    }\n    if (typeof customArgs !== 'object' || customArgs === null) {\n      throw new Error('Object expected for `customArgs`');\n    }\n    this.customArgs = customArgs;\n  }\n\n  /**\n   * Add a custom arg\n   */\n  addCustomArg(key, value) {\n    if (typeof key !== 'string') {\n      throw new Error('String expected for custom arg key');\n    }\n    if (typeof value !== 'string') {\n      throw new Error('String expected for custom arg value');\n    }\n    this.customArgs[key] = value;\n  }\n\n  /**\n   * Set substitutions\n   */\n  setSubstitutions(substitutions) {\n    if (typeof substitutions === 'undefined') {\n      return;\n    }\n    if (typeof substitutions !== 'object') {\n      throw new Error('Object expected for `substitutions`');\n    }\n    this.substitutions = substitutions;\n  }\n\n  /**\n   * Add a substitution\n   */\n  addSubstitution(key, value) {\n    if (typeof key !== 'string') {\n      throw new Error('String expected for substitution key');\n    }\n    if (typeof value !== 'string' && typeof value !== 'number') {\n      throw new Error('String or Number expected for substitution value');\n    }\n    this.substitutions[key] = value;\n  }\n\n  /**\n   * Reverse merge substitutions, preserving existing ones\n   */\n  reverseMergeSubstitutions(substitutions) {\n    if (typeof substitutions === 'undefined' || substitutions === null) {\n      return;\n    }\n    if (typeof substitutions !== 'object') {\n      throw new Error(\n        'Object expected for `substitutions` in reverseMergeSubstitutions'\n      );\n    }\n    this.substitutions = Object.assign({}, substitutions, this.substitutions);\n  }\n\n  /**\n   * Set substitution wrappers\n   */\n  setSubstitutionWrappers(wrappers) {\n    if (typeof wrappers === 'undefined' || wrappers === null) {\n      return;\n    }\n\n    if (!Array.isArray(wrappers) || wrappers.length !== 2) {\n      throw new Error(\n        'Array expected with two elements for `substitutionWrappers`'\n      );\n    }\n    this.substitutionWrappers = wrappers;\n  }\n\n  /**\n   * Reverse merge dynamic template data, preserving existing ones\n   */\n  deepMergeDynamicTemplateData(dynamicTemplateData) {\n    if (typeof dynamicTemplateData === 'undefined' || dynamicTemplateData === null) {\n      return;\n    }\n    if (typeof dynamicTemplateData !== 'object') {\n      throw new Error(\n        'Object expected for `dynamicTemplateData` in deepMergeDynamicTemplateData'\n      );\n    }\n    this.dynamicTemplateData = deepMerge(dynamicTemplateData, this.dynamicTemplateData);\n  }\n\n  /**\n   * Set dynamic template data\n   */\n  setDynamicTemplateData(dynamicTemplateData) {\n    if (typeof dynamicTemplateData === 'undefined') {\n      return;\n    }\n    if (typeof dynamicTemplateData !== 'object') {\n      throw new Error('Object expected for `dynamicTemplateData`');\n    }\n    this.dynamicTemplateData = dynamicTemplateData;\n  }\n\n  /**\n   * To JSON\n   */\n  toJSON() {\n\n    //Get data from self\n    const {\n      to, from, cc, bcc, subject, headers, customArgs, sendAt,\n      substitutions, substitutionWrappers, dynamicTemplateData,\n    } = this;\n\n    //Initialize with mandatory values\n    const json = {to};\n\n    //Arrays\n    if (Array.isArray(cc) && cc.length > 0) {\n      json.cc = cc;\n    }\n    if (Array.isArray(bcc) && bcc.length > 0) {\n      json.bcc = bcc;\n    }\n\n    //Objects\n    if (Object.keys(headers).length > 0) {\n      json.headers = headers;\n    }\n    if (substitutions && Object.keys(substitutions).length > 0) {\n      const [left, right] = substitutionWrappers;\n      json.substitutions = wrapSubstitutions(substitutions, left, right);\n    }\n    if (Object.keys(customArgs).length > 0) {\n      json.customArgs = customArgs;\n    }\n\n    if (dynamicTemplateData && Object.keys(dynamicTemplateData).length > 0) {\n      json.dynamicTemplateData = dynamicTemplateData;\n    }\n\n    //Simple properties\n    if (typeof subject !== 'undefined') {\n      json.subject = subject;\n    }\n    if (typeof sendAt !== 'undefined') {\n      json.sendAt = sendAt;\n    }\n    if (typeof from !== 'undefined') {\n      json.from = from;\n    }\n\n    //Return as snake cased object\n    return toSnakeCase(json, ['substitutions', 'dynamicTemplateData', 'customArgs', 'headers']);\n  }\n}\n\n//Export class\nmodule.exports = Personalization;\n"]},"metadata":{},"sourceType":"script"}